---
title: "Heliconia Demography Project"
# title: " "
date: "updated: `r Sys.Date()`"

header-includes:
- \AtBeginDocument{\let\maketitle\relax} # this removes default title section
- \usepackage[default]{sourcesanspro}
- \usepackage{fancyhdr} # modify header into left, center, right
- \pagestyle{fancy} # cues the use of fancy headers
- \fancyfoot{} # cues the use of fancy footer
- \fancyhead[R]{HDP Summary, p. \thepage} 
- \fancyfoot[R]{Last update `r format(Sys.time(), '%d %B %Y')`}

- \usepackage{parskip} # manipulate indents and spacing before/after paragra phs 
- \usepackage{xcolor} # changes colors of text
# more info # https://www.ctan.org/pkg/sectsty
- \usepackage{sectsty} \sectionfont{\centering\color{darkmidnightblue}}
- \usepackage{sectsty} \subsectionfont{\color{darkmidnightblue}}
# http://latexcolor.com/ to choose colors
- \definecolor{darkcerulean}{rgb}{0.03, 0.27, 0.49}
- \definecolor{darkmidnightblue}{rgb}{0.0, 0.2, 0.4}
# https://tex.stackexchange.com/questions/258714/prevent-hyphenation-across-lines-enforce-right-margin
# https://babichmorrowc.github.io/post/changing-fonts-in-rmarkdown-pdfs/
# bibliography: references.bib
mainfont: SourceSansPro
geometry: margin=1in
fontsize: 12pt
linkcolor: blue
urlcolor: blue

output:
  # pdf_document: default
  # html_document:
  #   df_print: paged
  rmdformats::robobook:
    toc: 3
    # toc_depth: 4
    # toc_float: 
    #   collapsed: TRUE
    use_bookdown: TRUE
# editor_options: 
#   markdown: 
#     wrap: 72
---



```{r setup, include=FALSE}
library(knitr)
library(rmdformats)
library(tidyverse)
library(kableExtra)

knitr::opts_chunk$set(echo = TRUE)
## Global options
options(max.print="75")
opts_chunk$set(echo=FALSE,
	             cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=75)
```

# Introduction & Contact Information

## Project Overview

This is site provides additional information on the _Heliconia_ Demography project and updates to the data published in Bruna et al. (20--).

## Contact for Questions or Suggestions

If you have questions regarding any of the HDP data sets or suggestions for improvement, please contact Emilio M. Bruna (embruna@ufl.edu) or post an issue on the [HDP Github Repository](link)


# HDP Data Overview

```{r data, cached=TRUE, echo = FALSE, warning=FALSE,message = FALSE}

ha_plants <- read_csv("./data/data_clean/heliconia_data_clean.csv", col_types = cols())
ha_plots <- read_csv("./data/data_archive/HDP_plots.csv", col_types = cols())
ha_plants <- ha_plants %>% left_join(ha_plots)
```

```{r nplants, cached=TRUE, warning=FALSE,message = FALSE}
nplants<-ha_plants %>%
  group_by(habitat, plot) %>%
  summarize(N_plants = n_distinct(plant_id)) %>%
  arrange(habitat, desc(N_plants)) %>%
  ungroup() %>%
  summarize(total_plants = sum(N_plants))
```

---

## __Last update:__ `r Sys.Date()`

--- 

## __Total no. of plants:__ N = `r nplants`  

---

## __Total plants per habitat type__

```{r n_by_habitat, cached=TRUE, warning=FALSE,message = FALSE}
n_by_habitat<-
ha_plants %>%
  group_by(habitat, plot) %>%
  summarize(N = n_distinct(plant_id)) %>%
  arrange(habitat, desc(N)) %>%
  summarize(N = sum(N)) %>% 
  arrange(N)
kbl(n_by_habitat)
```

---

## __Total no. of plants in each demographic plot__

```{r nplants_total, cached=TRUE, warning=FALSE,message = FALSE}
nplants_total<-ha_plants %>%
  group_by(habitat, plot) %>%
  summarize(N = n_distinct(plant_id)) %>%
  arrange(habitat, desc(N))
kbl(nplants_total)
```

--- 

## __Total no. of seedlings marked in each demographic plot__

```{r sldgs, cached=TRUE, warning=FALSE,message = FALSE}
n_sdlgs<-
ha_plants %>%
  filter(recorded_sdlg == TRUE) %>%
  group_by(habitat, plot) %>%
  tally() %>%
  arrange(habitat, desc(n))
kbl(n_sdlgs)
```
--- 

## __Total no. of established plants found without tags during the surveys__

```{r no_tag, cached=TRUE, warning=FALSE,message = FALSE}
no_tag<-ha_plants %>%
  filter(adult_no_tag == TRUE) %>%
  group_by(habitat, plot) %>%
  summarize(N = n_distinct(plant_id)) %>% 
  arrange(habitat, desc(N))
kbl(no_tag)
```
--- 

## __Plants marked per year (N and cumulative percentage)__

```{r recrt_yr, cached=TRUE, warning=FALSE,message = FALSE}
marked_per_yr <- ha_plants %>%
  group_by(plant_id) %>%
  filter(census_status == "measured") %>%
  filter(row_number() == 1) %>% 
  group_by(year) %>%
  count() %>%
  ungroup() %>%
  mutate('%' = round((n / sum(n) * 100),1)) %>%
  mutate('cumulative %' = round((cumsum(n) / sum(n) * 100),1))
kbl(marked_per_yr)
```

--- 

# Data Validation

Automated validation tests of the _Heliconia_ project data sets are carried out using the [`pointblank`](https://github.com/rich-iannone/pointblank/) package. Summaries of these validations tests, including links to `.csv` files of data flagged for review, are on the [_Heliconia_ Data Validation Page](https://brunalab.github.io/HeliconiaSurveys/data_validation.html)

<!-- ## HDP Project Publications:  [link](https://brunalab.github.io/HeliconiaSurveys/hdp_papers.html) -->

# Publications & Datasets: [link](https://brunalab.github.io/HeliconiaSurveys/hdp_datasets.html)

# Miscellaneous

## Tag Changes Log: [link](https://github.com/BrunaLab/HeliconiaSurveys/blob/1649ea958df1fc2da0187693bca40ce38bebb759/data_clean/tag_changes.csv)

## Treefall Records

### Treefall Records: [link] [in progress...]

### Plants impacted by treefalls: [link](https://github.com/BrunaLab/HeliconiaSurveys/blob/ca06ba6c501ad2bb6a43c6a6636cb09afccb5614/data_clean/treefall_impacts.csv)
