!function(){return function t(e,n,r){function o(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){return o(e[s][1][t]||t)},l,l.exports,t,e,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}}()({1:[function(t,e,n){e.exports=function(t){var e=this;t=t||{},e.type=t.type||"cache-module",e.verbose=t.verbose||!1,e.defaultExpiration=t.defaultExpiration||900,e.readOnly=t.readOnly||!1,e.checkOnPreviousEmpty="boolean"!=typeof t.checkOnPreviousEmpty||t.checkOnPreviousEmpty,e.backgroundRefreshIntervalCheck="boolean"!=typeof t.backgroundRefreshIntervalCheck||t.backgroundRefreshIntervalCheck,e.backgroundRefreshInterval=t.backgroundRefreshInterval||6e4,e.backgroundRefreshMinTtl=t.backgroundRefreshMinTtl||7e4;var n,r,o=null,i=t.storageMock||!1,s=!1,a="undefined"!=typeof window,u={db:{},expirations:{},refreshKeys:{}};function c(){if(a&&o||i){var t=u;try{t=JSON.stringify(t),o.setItem(n,t)}catch(t){}}}function l(t,e){if(t)throw new Error(e)}function h(){Object.keys(u.refreshKeys).forEach(function(t){var e=u.refreshKeys[t];e.expiration-Date.now()<this.backgroundRefreshMinTtl&&e.refresh(t,function(t,e,n,r){n||this.set(t,r,e.lifeSpan/1e3,e.refresh,function(){})}.bind(this,t,e))},e)}function f(t,n,r){(e.verbose||t)&&(r?console.log(e.type+": "+n,r):console.log(e.type+n))}!function(){if(a||i){if(i)o=i,n="cache-module-storage-mock";else{var r="local"===t.storage||"session"===t.storage?t.storage:null;o=!(!r||void 0===typeof Storage)&&window[r+"Storage"],n=r?e.type+"-"+r+"-storage":null}if(o){var s=o.getItem(n);try{u=JSON.parse(s)||u}catch(t){}}else r&&f(!0,"Browser storage is not supported by this browser. Defaulting to an in-memory cache.")}}(),f(!1,"Cache-module client created with the following defaults:",{type:e.type,defaultExpiration:e.defaultExpiration,verbose:e.verbose,readOnly:e.readOnly}),e.get=function(t,e){l(arguments.length<2,"ARGUMENT_EXCEPTION: .get() requires 2 arguments."),f(!1,"get() called:",{key:t});try{var n=Date.now();if(u.expirations[t]>n){var r=u.db[t];"object"==typeof r&&(o=r,r=JSON.parse(JSON.stringify(o))),e(null,r)}else!function(t){delete u.db[t],delete u.expirations[t],c()}(t),e(null,null)}catch(t){e({name:"GetException",message:t},null)}var o},e.mget=function(t,n,r){l(arguments.length<2,"ARGUMENT_EXCEPTION: .mget() requires 2 arguments."),f(!1,".mget() called:",{keys:t});for(var o={},i=0;i<t.length;i++){var s=t[i];e.get(s,function(t,e){null!==e&&(o[s]=e)})}n(null,o,r)},e.set=function(){l(arguments.length<2,"ARGUMENT_EXCEPTION: .set() requires at least 2 arguments.");var t=arguments[0],n=arguments[1],o=arguments[2]||null,i=5==arguments.length?arguments[3]:null,a=5==arguments.length?arguments[4]:arguments[3];if(f(!1,".set() called:",{key:t,value:n}),!e.readOnly)try{var d=(o=o?1e3*o:1e3*e.defaultExpiration)+Date.now();u.expirations[t]=d,u.db[t]=n,a&&a(),i&&(u.refreshKeys[t]={expiration:d,lifeSpan:o,refresh:i},function(){if(!s){if(s=!0,e.backgroundRefreshIntervalCheck&&e.backgroundRefreshInterval>e.backgroundRefreshMinTtl)throw new Error("BACKGROUND_REFRESH_INTERVAL_EXCEPTION: backgroundRefreshInterval cannot be greater than backgroundRefreshMinTtl.");r=setInterval(h,e.backgroundRefreshInterval)}}()),c()}catch(t){f(!0,".set() failed for cache of type "+e.type,{name:"CacheModuleSetException",message:t})}},e.mset=function(t,n,r){for(var o in l(arguments.length<1,"ARGUMENT_EXCEPTION: .mset() requires at least 1 argument."),f(!1,".mset() called:",{data:t}),t)if(t.hasOwnProperty(o)){var i=n||e.defaultExpiration,s=t[o];"object"==typeof s&&s.cacheValue&&(i=s.expiration||i,s=s.cacheValue),e.set(o,s,i)}r&&r()},e.del=function(t,e){if(l(arguments.length<1,"ARGUMENT_EXCEPTION: .del() requires at least 1 argument."),f(!1,".del() called:",{keys:t}),"object"==typeof t){for(var n=0;n<t.length;n++){var r=t[n];delete u.db[r],delete u.expirations[r],delete u.refreshKeys[r]}e&&e(null,t.length)}else delete u.db[t],delete u.expirations[t],delete u.refreshKeys[t],e&&e(null,1);c()},e.flush=function(t){f(!1,".flush() called"),u.db={},u.expirations={},u.refreshKeys={},t&&t(),c(),r&&clearInterval(r),s=!1}}},{}],2:[function(t,e,n){function r(t){if(t)return function(t){for(var e in r.prototype)t[e]=r.prototype[e];return t}(t)}void 0!==e&&(e.exports=r),r.prototype.on=r.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},r.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+t];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var o=0;o<r.length;o++)if((n=r[o])===e||n.fn===e){r.splice(o,1);break}return 0===r.length&&delete this._callbacks["$"+t],this},r.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(n){r=0;for(var o=(n=n.slice(0)).length;r<o;++r)n[r].apply(this,e)}return this},r.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},r.prototype.hasListeners=function(t){return!!this.listeners(t).length}},{}],3:[function(t,e,n){!function(t,n){void 0!==e?e.exports=n():"function"==typeof define&&"object"==typeof define.amd?define(n):this.domready=n()}(0,function(t){var e,n=[],r=document,o=r.documentElement,i=o.doScroll,s=(i?/^loaded|^c/:/^loaded|c/).test(r.readyState);function a(t){for(s=1;t=n.shift();)t()}return r.addEventListener&&r.addEventListener("DOMContentLoaded",e=function(){r.removeEventListener("DOMContentLoaded",e,!1),a()},!1),i&&r.attachEvent("onreadystatechange",e=function(){/^c/.test(r.readyState)&&(r.detachEvent("onreadystatechange",e),a())}),t=i?function(e){self!=top?s?e():n.push(e):function(){try{o.doScroll("left")}catch(n){return setTimeout(function(){t(e)},50)}e()}()}:function(t){s?t():n.push(t)}})},{}],4:[function(t,e,n){(function(t){!function(r){var o="object"==typeof n&&n&&!n.nodeType&&n,i="object"==typeof e&&e&&!e.nodeType&&e,s="object"==typeof t&&t;s.global!==s&&s.window!==s&&s.self!==s||(r=s);var a,u,c=2147483647,l=36,h=1,f=26,d=38,p=700,g=72,m=128,y="-",v=/^xn--/,b=/[^\x20-\x7E]/,w=/[\x2E\u3002\uFF0E\uFF61]/g,_={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},k=l-h,C=Math.floor,O=String.fromCharCode;function E(t){throw new RangeError(_[t])}function j(t,e){for(var n=t.length,r=[];n--;)r[n]=e(t[n]);return r}function P(t,e){var n=t.split("@"),r="";return n.length>1&&(r=n[0]+"@",t=n[1]),r+j((t=t.replace(w,".")).split("."),e).join(".")}function T(t){for(var e,n,r=[],o=0,i=t.length;o<i;)(e=t.charCodeAt(o++))>=55296&&e<=56319&&o<i?56320==(64512&(n=t.charCodeAt(o++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),o--):r.push(e);return r}function x(t){return j(t,function(t){var e="";return t>65535&&(e+=O((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=O(t)}).join("")}function I(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function S(t,e,n){var r=0;for(t=n?C(t/p):t>>1,t+=C(t/e);t>k*f>>1;r+=l)t=C(t/k);return C(r+(k+1)*t/(t+d))}function R(t){var e,n,r,o,i,s,a,u,d,p,v,b=[],w=t.length,_=0,k=m,O=g;for((n=t.lastIndexOf(y))<0&&(n=0),r=0;r<n;++r)t.charCodeAt(r)>=128&&E("not-basic"),b.push(t.charCodeAt(r));for(o=n>0?n+1:0;o<w;){for(i=_,s=1,a=l;o>=w&&E("invalid-input"),((u=(v=t.charCodeAt(o++))-48<10?v-22:v-65<26?v-65:v-97<26?v-97:l)>=l||u>C((c-_)/s))&&E("overflow"),_+=u*s,!(u<(d=a<=O?h:a>=O+f?f:a-O));a+=l)s>C(c/(p=l-d))&&E("overflow"),s*=p;O=S(_-i,e=b.length+1,0==i),C(_/e)>c-k&&E("overflow"),k+=C(_/e),_%=e,b.splice(_++,0,k)}return x(b)}function A(t){var e,n,r,o,i,s,a,u,d,p,v,b,w,_,k,j=[];for(b=(t=T(t)).length,e=m,n=0,i=g,s=0;s<b;++s)(v=t[s])<128&&j.push(O(v));for(r=o=j.length,o&&j.push(y);r<b;){for(a=c,s=0;s<b;++s)(v=t[s])>=e&&v<a&&(a=v);for(a-e>C((c-n)/(w=r+1))&&E("overflow"),n+=(a-e)*w,e=a,s=0;s<b;++s)if((v=t[s])<e&&++n>c&&E("overflow"),v==e){for(u=n,d=l;!(u<(p=d<=i?h:d>=i+f?f:d-i));d+=l)k=u-p,_=l-p,j.push(O(I(p+k%_,0))),u=C(k/_);j.push(O(I(u,0))),i=S(n,w,r==o),n=0,++r}++n,++e}return j.join("")}if(a={version:"1.4.1",ucs2:{decode:T,encode:x},decode:R,encode:A,toASCII:function(t){return P(t,function(t){return b.test(t)?"xn--"+A(t):t})},toUnicode:function(t){return P(t,function(t){return v.test(t)?R(t.slice(4).toLowerCase()):t})}},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return a});else if(o&&i)if(e.exports==o)i.exports=a;else for(u in a)a.hasOwnProperty(u)&&(o[u]=a[u]);else r.punycode=a}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(t,e,n){"use strict";function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.exports=function(t,e,n,i){e=e||"&",n=n||"=";var s={};if("string"!=typeof t||0===t.length)return s;var a=/\+/g;t=t.split(e);var u=1e3;i&&"number"==typeof i.maxKeys&&(u=i.maxKeys);var c=t.length;u>0&&c>u&&(c=u);for(var l=0;l<c;++l){var h,f,d,p,g=t[l].replace(a,"%20"),m=g.indexOf(n);m>=0?(h=g.substr(0,m),f=g.substr(m+1)):(h=g,f=""),d=decodeURIComponent(h),p=decodeURIComponent(f),r(s,d)?o(s[d])?s[d].push(p):s[d]=[s[d],p]:s[d]=p}return s};var o=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{}],6:[function(t,e,n){"use strict";var r=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};e.exports=function(t,e,n,a){return e=e||"&",n=n||"=",null===t&&(t=void 0),"object"==typeof t?i(s(t),function(s){var a=encodeURIComponent(r(s))+n;return o(t[s])?i(t[s],function(t){return a+encodeURIComponent(r(t))}).join(e):a+encodeURIComponent(r(t[s]))}).join(e):a?encodeURIComponent(r(a))+n+encodeURIComponent(r(t)):""};var o=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function i(t,e){if(t.map)return t.map(e);for(var n=[],r=0;r<t.length;r++)n.push(e(t[r],r));return n}var s=Object.keys||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e}},{}],7:[function(t,e,n){"use strict";n.decode=n.parse=t("./decode"),n.encode=n.stringify=t("./encode")},{"./decode":5,"./encode":6}],8:[function(t,e,n){var r=t("./utils");e.exports=function(t,e){var n=this,o=["GET","HEAD","POST","PUT","PATCH","DELETE"],i=["GET","HEAD"];return this.cache=t,this.defaults=e||{},function(e){var s=r.resetProps(n.defaults);e.doQuery=function(t){return s.doQuery=t,e},e.pruneQuery=function(t){return s.pruneQuery=t,e},e.pruneHeader=function(t){return s.pruneHeader=t,e},e.prune=function(t){return s.prune=t,e},e.responseProp=function(t){return s.responseProp=t,e},e.expiration=function(t){return s.expiration=t,e},e.cacheWhenEmpty=function(t){return s.cacheWhenEmpty=t,e},e.forceUpdate=function(t){return s.forceUpdate="boolean"!=typeof t||t,e};var a=e.end;return e.end=function(n){if(e.scRedirectsList=e.scRedirectsList||[],e.scRedirectsList=e.scRedirectsList.concat(e._redirectList),~o.indexOf(e.method.toUpperCase())){var u=e,c=r.keygen(e,s);~i.indexOf(e.method.toUpperCase())?t.get(c,function(o,i){if(o||!i||s.forceUpdate){if(!s.doQuery)return r.callbackExecutor(n,null,null,c);a.call(e,function(e,o){if(e)return r.callbackExecutor(n,e,o,c);if(!e&&o){if(o.redirects=u.scRedirectsList,o=s.prune?s.prune(o):s.responseProp?o[s.responseProp]||null:r.gutResponse(o),r.isEmpty(o)&&!s.cacheWhenEmpty)return r.callbackExecutor(n,e,o,c);t.set(c,o,s.expiration,function(){return r.callbackExecutor(n,e,o,c)})}})}else r.callbackExecutor(n,o,i,c)}):a.call(e,function(e,o){if(e)return r.callbackExecutor(n,e,o,c);if(!e&&o){var i=c.replace('"method":"'+u.method+'"','"method":"GET"'),s=c.replace('"method":"'+u.method+'"','"method":"HEAD"');t.del([i,s],function(){r.callbackExecutor(n,e,o,c)})}})}else a.call(e,function(t,e){return r.callbackExecutor(n,t,e,void 0)})},e}}},{"./utils":9}],9:[function(t,e,n){e.exports={keygen:function(t,e){var n=null,r=null,o=this.getQueryParams(t),i=this.getHeaderOptions(t);return(e.pruneQuery||e.pruneHeader)&&(n=e.pruneQuery?this.pruneObj(this.cloneObject(o),e.pruneQuery):o,r=e.pruneHeader?this.pruneObj(this.cloneObject(i),e.pruneHeader,!0):i),JSON.stringify({method:t.method,uri:t.url,params:n||o||null,options:r||i||null})},getQueryParams:function(t){return t&&t.qs&&!this.isEmpty(t.qs)?t.qs:t&&t.qsRaw?this.arrayToObj(t.qsRaw):t&&t.req?this.stringToObj(t.req.path):t&&t._query?this.stringToObj(t._query.join("&")):null},getHeaderOptions:function(t){return t&&t._header?this.pruneObj(t._header,["User-Agent","user-agent"]):t&&t.req&&t.req._headers?this.pruneObj(t.req._headers,["User-Agent","user-agent"]):t&&t.header?this.pruneObj(t.header,["User-Agent","user-agent"]):null},arrayToObj:function(t){if(t&&t.length){for(var e={},n=0;n<t.length;n++)for(var r=t[n].split("&"),o=0;o<r.length;o++){var i=r[o].split("=");e[i[0]]=i[1]}return e}return null},stringToObj:function(t){if(t){var e={};if(~t.indexOf("?")){var n=t.split("?");t=n[1]}for(var r=t.split("&"),o=0;o<r.length;o++){var i=r[o].split("=");e[i[0]]=i[1]}return e}return null},pruneObj:function(t,e,n){for(var r=0;r<e.length;r++){var o=e[r];n&&delete t[o.toLowerCase()],delete t[o]}return t},gutResponse:function(t){var e={};return e.body=t.body,e.text=t.text,e.headers=t.headers,e.statusCode=t.statusCode,e.status=t.status,e.ok=t.ok,e},isEmpty:function(t){return!1===t||null===t||"object"==typeof t&&0==Object.keys(t).length},cloneObject:function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},resetProps:function(t){return{doQuery:"boolean"!=typeof t.doQuery||t.doQuery,cacheWhenEmpty:"boolean"!=typeof t.cacheWhenEmpty||t.cacheWhenEmpty,prune:t.prune,pruneQuery:t.pruneQuery,pruneHeader:t.pruneHeader,responseProp:t.responseProp,expiration:t.expiration,forceUpdate:t.forceUpdate,preventDuplicateCalls:t.preventDuplicateCalls,backgroundRefresh:t.backgroundRefresh}},callbackExecutor:function(t,e,n,r){if(1===t.length)t(n);else{if(!(t.length>1))throw new Error("UnsupportedCallbackException: Your .end() callback must pass at least one argument.");t(e,n,r)}}}},{}],10:[function(t,e,n){function r(){this._defaults=[]}["use","on","once","set","query","type","accept","auth","withCredentials","sortQuery","retry","ok","redirects","timeout","buffer","serialize","parse","ca","key","pfx","cert"].forEach(function(t){r.prototype[t]=function(){return this._defaults.push({fn:t,arguments:arguments}),this}}),r.prototype._setDefaults=function(t){this._defaults.forEach(function(e){t[e.fn].apply(t,e.arguments)})},e.exports=r},{}],11:[function(t,e,n){var r;"undefined"!=typeof window?r=window:"undefined"!=typeof self?r=self:(console.warn("Using browser-only version of superagent in non-browser environment"),r=this);var o=t("component-emitter"),i=t("./request-base"),s=t("./is-object"),a=t("./response-base"),u=t("./agent-base");function c(){}var l=n=e.exports=function(t,e){return"function"==typeof e?new n.Request("GET",t).end(e):1==arguments.length?new n.Request("GET",t):new n.Request(t,e)};n.Request=y,l.getXHR=function(){if(!(!r.XMLHttpRequest||r.location&&"file:"==r.location.protocol&&r.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}throw Error("Browser-only version of superagent could not find XHR")};var h="".trim?function(t){return t.trim()}:function(t){return t.replace(/(^\s*|\s*$)/g,"")};function f(t){if(!s(t))return t;var e=[];for(var n in t)d(e,n,t[n]);return e.join("&")}function d(t,e,n){if(null!=n)if(Array.isArray(n))n.forEach(function(n){d(t,e,n)});else if(s(n))for(var r in n)d(t,e+"["+r+"]",n[r]);else t.push(encodeURIComponent(e)+"="+encodeURIComponent(n));else null===n&&t.push(encodeURIComponent(e))}function p(t){for(var e,n,r={},o=t.split("&"),i=0,s=o.length;i<s;++i)-1==(n=(e=o[i]).indexOf("="))?r[decodeURIComponent(e)]="":r[decodeURIComponent(e.slice(0,n))]=decodeURIComponent(e.slice(n+1));return r}function g(t){return/[\/+]json($|[^-\w])/.test(t)}function m(t){this.req=t,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||void 0===this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var e=this.xhr.status;1223===e&&(e=204),this._setStatusProperties(e),this.header=this.headers=function(t){for(var e,n,r,o,i=t.split(/\r?\n/),s={},a=0,u=i.length;a<u;++a)-1!==(e=(n=i[a]).indexOf(":"))&&(r=n.slice(0,e).toLowerCase(),o=h(n.slice(e+1)),s[r]=o);return s}(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),null===this.text&&t._responseType?this.body=this.xhr.response:this.body="HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function y(t,e){var n=this;this._query=this._query||[],this.method=t,this.url=e,this.header={},this._header={},this.on("end",function(){var t,e=null,r=null;try{r=new m(n)}catch(t){return(e=new Error("Parser is unable to parse the response")).parse=!0,e.original=t,n.xhr?(e.rawResponse=void 0===n.xhr.responseType?n.xhr.responseText:n.xhr.response,e.status=n.xhr.status?n.xhr.status:null,e.statusCode=e.status):(e.rawResponse=null,e.status=null),n.callback(e)}n.emit("response",r);try{n._isResponseOK(r)||(t=new Error(r.statusText||"Unsuccessful HTTP response"))}catch(e){t=e}t?(t.original=e,t.response=r,t.status=r.status,n.callback(t,r)):n.callback(null,r)})}function v(t,e,n){var r=l("DELETE",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r}l.serializeObject=f,l.parseString=p,l.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},l.serialize={"application/x-www-form-urlencoded":f,"application/json":JSON.stringify},l.parse={"application/x-www-form-urlencoded":p,"application/json":JSON.parse},a(m.prototype),m.prototype._parseBody=function(t){var e=l.parse[this.type];return this.req._parser?this.req._parser(this,t):(!e&&g(this.type)&&(e=l.parse["application/json"]),e&&t&&(t.length||t instanceof Object)?e(t):null)},m.prototype.toError=function(){var t=this.req,e=t.method,n=t.url,r="cannot "+e+" "+n+" ("+this.status+")",o=new Error(r);return o.status=this.status,o.method=e,o.url=n,o},l.Response=m,o(y.prototype),i(y.prototype),y.prototype.type=function(t){return this.set("Content-Type",l.types[t]||t),this},y.prototype.accept=function(t){return this.set("Accept",l.types[t]||t),this},y.prototype.auth=function(t,e,n){1===arguments.length&&(e=""),"object"==typeof e&&null!==e&&(n=e,e=""),n||(n={type:"function"==typeof btoa?"basic":"auto"});return this._auth(t,e,n,function(t){if("function"==typeof btoa)return btoa(t);throw new Error("Cannot use basic auth, btoa is not a function")})},y.prototype.query=function(t){return"string"!=typeof t&&(t=f(t)),t&&this._query.push(t),this},y.prototype.attach=function(t,e,n){if(e){if(this._data)throw Error("superagent can't mix .send() and .attach()");this._getFormData().append(t,e,n||e.name)}return this},y.prototype._getFormData=function(){return this._formData||(this._formData=new r.FormData),this._formData},y.prototype.callback=function(t,e){if(this._shouldRetry(t,e))return this._retry();var n=this._callback;this.clearTimeout(),t&&(this._maxRetries&&(t.retries=this._retries-1),this.emit("error",t)),n(t,e)},y.prototype.crossDomainError=function(){var t=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");t.crossDomain=!0,t.status=this.status,t.method=this.method,t.url=this.url,this.callback(t)},y.prototype.buffer=y.prototype.ca=y.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},y.prototype.pipe=y.prototype.write=function(){throw Error("Streaming is not supported in browser version of superagent")},y.prototype._isHost=function(t){return t&&"object"==typeof t&&!Array.isArray(t)&&"[object Object]"!==Object.prototype.toString.call(t)},y.prototype.end=function(t){return this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=t||c,this._finalizeQueryString(),this._end()},y.prototype._end=function(){var t=this,e=this.xhr=l.getXHR(),n=this._formData||this._data;this._setTimeouts(),e.onreadystatechange=function(){var n=e.readyState;if(n>=2&&t._responseTimeoutTimer&&clearTimeout(t._responseTimeoutTimer),4==n){var r;try{r=e.status}catch(t){r=0}if(!r){if(t.timedout||t._aborted)return;return t.crossDomainError()}t.emit("end")}};var r=function(e,n){n.total>0&&(n.percent=n.loaded/n.total*100),n.direction=e,t.emit("progress",n)};if(this.hasListeners("progress"))try{e.onprogress=r.bind(null,"download"),e.upload&&(e.upload.onprogress=r.bind(null,"upload"))}catch(t){}try{this.username&&this.password?e.open(this.method,this.url,!0,this.username,this.password):e.open(this.method,this.url,!0)}catch(t){return this.callback(t)}if(this._withCredentials&&(e.withCredentials=!0),!this._formData&&"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof n&&!this._isHost(n)){var o=this._header["content-type"],i=this._serializer||l.serialize[o?o.split(";")[0]:""];!i&&g(o)&&(i=l.serialize["application/json"]),i&&(n=i(n))}for(var s in this.header)null!=this.header[s]&&this.header.hasOwnProperty(s)&&e.setRequestHeader(s,this.header[s]);return this._responseType&&(e.responseType=this._responseType),this.emit("request",this),e.send(void 0!==n?n:null),this},l.agent=function(){return new u},["GET","POST","OPTIONS","PATCH","PUT","DELETE"].forEach(function(t){u.prototype[t.toLowerCase()]=function(e,n){var r=new l.Request(t,e);return this._setDefaults(r),n&&r.end(n),r}}),u.prototype.del=u.prototype.delete,l.get=function(t,e,n){var r=l("GET",t);return"function"==typeof e&&(n=e,e=null),e&&r.query(e),n&&r.end(n),r},l.head=function(t,e,n){var r=l("HEAD",t);return"function"==typeof e&&(n=e,e=null),e&&r.query(e),n&&r.end(n),r},l.options=function(t,e,n){var r=l("OPTIONS",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},l.del=v,l.delete=v,l.patch=function(t,e,n){var r=l("PATCH",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},l.post=function(t,e,n){var r=l("POST",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},l.put=function(t,e,n){var r=l("PUT",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r}},{"./agent-base":10,"./is-object":12,"./request-base":13,"./response-base":14,"component-emitter":2}],12:[function(t,e,n){"use strict";e.exports=function(t){return null!==t&&"object"==typeof t}},{}],13:[function(t,e,n){"use strict";var r=t("./is-object");function o(t){if(t)return function(t){for(var e in o.prototype)t[e]=o.prototype[e];return t}(t)}e.exports=o,o.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,this},o.prototype.parse=function(t){return this._parser=t,this},o.prototype.responseType=function(t){return this._responseType=t,this},o.prototype.serialize=function(t){return this._serializer=t,this},o.prototype.timeout=function(t){if(!t||"object"!=typeof t)return this._timeout=t,this._responseTimeout=0,this;for(var e in t)switch(e){case"deadline":this._timeout=t.deadline;break;case"response":this._responseTimeout=t.response;break;default:console.warn("Unknown timeout option",e)}return this},o.prototype.retry=function(t,e){return 0!==arguments.length&&!0!==t||(t=1),t<=0&&(t=0),this._maxRetries=t,this._retries=0,this._retryCallback=e,this};var i=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];o.prototype._shouldRetry=function(t,e){if(!this._maxRetries||this._retries++>=this._maxRetries)return!1;if(this._retryCallback)try{var n=this._retryCallback(t,e);if(!0===n)return!0;if(!1===n)return!1}catch(t){console.error(t)}if(e&&e.status&&e.status>=500&&501!=e.status)return!0;if(t){if(t.code&&~i.indexOf(t.code))return!0;if(t.timeout&&"ECONNABORTED"==t.code)return!0;if(t.crossDomain)return!0}return!1},o.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this._end()},o.prototype.then=function(t,e){if(!this._fullfilledPromise){var n=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise(function(t,e){n.end(function(n,r){n?e(n):t(r)})})}return this._fullfilledPromise.then(t,e)},o.prototype.catch=function(t){return this.then(void 0,t)},o.prototype.use=function(t){return t(this),this},o.prototype.ok=function(t){if("function"!=typeof t)throw Error("Callback required");return this._okCallback=t,this},o.prototype._isResponseOK=function(t){return!!t&&(this._okCallback?this._okCallback(t):t.status>=200&&t.status<300)},o.prototype.get=function(t){return this._header[t.toLowerCase()]},o.prototype.getHeader=o.prototype.get,o.prototype.set=function(t,e){if(r(t)){for(var n in t)this.set(n,t[n]);return this}return this._header[t.toLowerCase()]=e,this.header[t]=e,this},o.prototype.unset=function(t){return delete this._header[t.toLowerCase()],delete this.header[t],this},o.prototype.field=function(t,e){if(null==t)throw new Error(".field(name, val) name can not be empty");if(this._data&&console.error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()"),r(t)){for(var n in t)this.field(n,t[n]);return this}if(Array.isArray(e)){for(var o in e)this.field(t,e[o]);return this}if(null==e)throw new Error(".field(name, val) val can not be empty");return"boolean"==typeof e&&(e=""+e),this._getFormData().append(t,e),this},o.prototype.abort=function(){return this._aborted?this:(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort"),this)},o.prototype._auth=function(t,e,n,r){switch(n.type){case"basic":this.set("Authorization","Basic "+r(t+":"+e));break;case"auto":this.username=t,this.password=e;break;case"bearer":this.set("Authorization","Bearer "+t)}return this},o.prototype.withCredentials=function(t){return null==t&&(t=!0),this._withCredentials=t,this},o.prototype.redirects=function(t){return this._maxRedirects=t,this},o.prototype.maxResponseSize=function(t){if("number"!=typeof t)throw TypeError("Invalid argument");return this._maxResponseSize=t,this},o.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},o.prototype.send=function(t){var e=r(t),n=this._header["content-type"];if(this._formData&&console.error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()"),e&&!this._data)Array.isArray(t)?this._data=[]:this._isHost(t)||(this._data={});else if(t&&this._data&&this._isHost(this._data))throw Error("Can't merge these send calls");if(e&&r(this._data))for(var o in t)this._data[o]=t[o];else"string"==typeof t?(n||this.type("form"),n=this._header["content-type"],this._data="application/x-www-form-urlencoded"==n?this._data?this._data+"&"+t:t:(this._data||"")+t):this._data=t;return!e||this._isHost(t)?this:(n||this.type("json"),this)},o.prototype.sortQuery=function(t){return this._sort=void 0===t||t,this},o.prototype._finalizeQueryString=function(){var t=this._query.join("&");if(t&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+t),this._query.length=0,this._sort){var e=this.url.indexOf("?");if(e>=0){var n=this.url.substring(e+1).split("&");"function"==typeof this._sort?n.sort(this._sort):n.sort(),this.url=this.url.substring(0,e)+"?"+n.join("&")}}},o.prototype._appendQueryString=function(){console.trace("Unsupported")},o.prototype._timeoutError=function(t,e,n){if(!this._aborted){var r=new Error(t+e+"ms exceeded");r.timeout=e,r.code="ECONNABORTED",r.errno=n,this.timedout=!0,this.abort(),this.callback(r)}},o.prototype._setTimeouts=function(){var t=this;this._timeout&&!this._timer&&(this._timer=setTimeout(function(){t._timeoutError("Timeout of ",t._timeout,"ETIME")},this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout(function(){t._timeoutError("Response timeout of ",t._responseTimeout,"ETIMEDOUT")},this._responseTimeout))}},{"./is-object":12}],14:[function(t,e,n){"use strict";var r=t("./utils");function o(t){if(t)return function(t){for(var e in o.prototype)t[e]=o.prototype[e];return t}(t)}e.exports=o,o.prototype.get=function(t){return this.header[t.toLowerCase()]},o.prototype._setHeaderProperties=function(t){var e=t["content-type"]||"";this.type=r.type(e);var n=r.params(e);for(var o in n)this[o]=n[o];this.links={};try{t.link&&(this.links=r.parseLinks(t.link))}catch(t){}},o.prototype._setStatusProperties=function(t){var e=t/100|0;this.status=this.statusCode=t,this.statusType=e,this.info=1==e,this.ok=2==e,this.redirect=3==e,this.clientError=4==e,this.serverError=5==e,this.error=(4==e||5==e)&&this.toError(),this.created=201==t,this.accepted=202==t,this.noContent=204==t,this.badRequest=400==t,this.unauthorized=401==t,this.notAcceptable=406==t,this.forbidden=403==t,this.notFound=404==t,this.unprocessableEntity=422==t}},{"./utils":15}],15:[function(t,e,n){"use strict";n.type=function(t){return t.split(/ *; */).shift()},n.params=function(t){return t.split(/ *; */).reduce(function(t,e){var n=e.split(/ *= */),r=n.shift(),o=n.shift();return r&&o&&(t[r]=o),t},{})},n.parseLinks=function(t){return t.split(/ *, */).reduce(function(t,e){var n=e.split(/ *; */),r=n[0].slice(1,-1);return t[n[1].split(/ *= */)[1].slice(1,-1)]=r,t},{})},n.cleanHeader=function(t,e){return delete t["content-type"],delete t["content-length"],delete t["transfer-encoding"],delete t.host,e&&(delete t.authorization,delete t.cookie),t}},{}],16:[function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.candidates=e;var r=[{re:new RegExp(""+this.constructor.re.start+this.constructor.yearAndMonthName.parts.map(function(t){return n.constructor.re[t]}).join(this.constructor.re.separator)+this.constructor.re.end),year:this.constructor.yearAndMonthName.year,month:this.constructor.yearAndMonthName.month,name:!0}];this.patterns=r.concat(["yearAndMonth","dayMonthNameYear","monthDayYear","monthNameDayYear","monthYear","monthNameAndYear","year"].map(function(t){return n.constructor[t]}).map(function(t){return{re:new RegExp(""+n.constructor.re.start+t.parts.map(function(t){return n.constructor.re[t]}).join(n.constructor.re.separator)+n.constructor.re.end),year:t.year,month:t.month,name:t.name}})),this.extracted=this.constructor.compact(this.candidates.map(function(t){return n.extract(t)})),this.sorted=this.extracted.sort(function(t,e){return t[0]+"-"+(t[1]||99)<e[0]+"-"+(e[1]||99)?-1:1}),this.publicationDate=this.sorted[0]}return r(t,[{key:"extract",value:function(t){for(var e=["january","february","march","april","may","june","july","august","september","october","november","december"],n=0;n<this.patterns.length;n+=1){var r=this.patterns[n],o=t.match(r.re);if(o){var i=null;if(r.month&&(i=o[r.month],r.name))for(var s=i.toLowerCase(),a=0;a<e.length;a+=1){var u=e[a];u.match(s)&&(i=String(e.indexOf(u)+1))}return this.constructor.compact([o[r.year],i])}}return null}}],[{key:"compact",value:function(t){return t.filter(function(t){return null!=t})}}]),t}();o.re={year:"(1[89]\\d{2}|20\\d{2})",month:"(\\d{1,2})",monthName:"(\\w{3,9})",day:"\\d{1,2}\\w{0,2}",start:"(\\D|^)",end:"(\\D|$)",separator:"[.,/-\\s]+"},o.yearAndMonth={parts:["year","month"],year:2,month:3},o.yearAndMonthName={parts:["year","monthName"],year:2,month:3,name:!0},o.monthDayYear={parts:["month","day","year"],year:3,month:2},o.monthNameDayYear={parts:["monthName","day","year"],year:3,month:2,name:!0},o.dayMonthNameYear={parts:["day","monthName","year"],year:3,month:2,name:!0},o.monthYear={parts:["month","year"],year:3,month:2},o.monthNameAndYear={parts:["monthName","year"],year:3,month:2,name:!0},o.year={parts:["year"],year:2},e.exports={DateParser:o}},{}],17:[function(t,e,n){"use strict";e.exports=function(t){return t.replace(/_([a-z])/g,function(t){return t[1].toUpperCase()})}},{}],18:[function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o=t("./sources"),i=t("./DateParser").DateParser,s=t("./camelCase"),a=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!e)throw new Error("document is required for new MetaExtractor instance");this.options=n,this.parse(e)}return r(t,[{key:"parse",value:function(t){var e=this,n=this.options.sources||this.constructor.defaultSources,r=this.options.meta_extractor_options,a=void 0===r?{prioritizeSelectors:void 0}:r,u=a.prioritizeSelectors,c=a.selectorsToRemoveFromInnerHTML||this.constructor.defaultSelectorsToRemoveFromInnerHTML;u&&(this.options.prioritizeSelectors=u,n=n.reduce(function(t,e){return"Selectors"===e?[e].concat(t):(t.push(e),t)},[])),this.sources=n.map(function(n){return new("string"==typeof n?o[n]:n)(t,e.options,c)}),[].slice.call(t.querySelectorAll("meta")).forEach(function(t){e.sources.forEach(function(e){e.add(t)})}),(this.options.tags||this.constructor.defaultTags).forEach(function(t){if("publication_date"===t){var n=new i(e.forCompact("publication_date")).publicationDate;n&&(e.publicationYear=n[0],e.publicationMonth=n[1])}else{var r="get"+e.constructor.ucCamelCase(t);e[s(t)]=e[r]?e[r]():e.firstFor(t)}})}},{key:"getPubmedId",value:function(){return this.firstFor("pubmed_id",Number)}},{key:"getDoi",value:function(){var t=this.firstFor("doi");if(t)return t.trim().replace("doi:","").replace("info:doi/","").replace("http://","").replace("https://","").replace("dx.doi.org/","").replace("doi.org/","").replace("doi","").replace("DOI","")}},{key:"getIssn",value:function(){var t=this.firstFor("issn");if(t)return t.trim().replace("issn:","").replace("info:issn/","")}},{key:"getAuthors",value:function(){var t=this.constructor.uniq(this.forCompact("authors"));if(!(t.length>1))return t[0]||void 0;for(var e=0;e<t.length;e+=1)if(t[e])return t[e]+" et al."}},{key:"getAbstract",value:function(){var t=this.options.prioritizeSelectors?0:7;return this.sources[t].get("abstract")||this.firstFor("abstract")}},{key:"firstFor",value:function(t,e){var n=this.forCompact(t);return e&&(n=n.filter(e)),n[0]}},{key:"forCompact",value:function(t){var e=[];return this.sources.map(function(e){return e.get(t)}).forEach(function(n){e="title"===t&&n?e.concat(n.replace(/^(【In Press】|In Press):?/i,"").trim()):e.concat(n)}),this.constructor.compact(e)}},{key:"publication_year",get:function(){return this.publicationYear},set:function(t){this.publicationYear=t}},{key:"publication_month",get:function(){return this.publicationMonth},set:function(t){this.publicationMonth=t}},{key:"journal_title",get:function(){return this.journalTitle.trim()},set:function(t){this.journalTitle=t}},{key:"custom_id",get:function(){return this.customId},set:function(t){this.customId=t}}],[{key:"ucCamelCase",value:function(t){var e=s(t);return e.charAt(0).toUpperCase()+e.substr(1)}},{key:"compact",value:function(t){return t.filter(function(t){return null!=t})}},{key:"uniq",value:function(t){return t.filter(function(e,n){return t.indexOf(e)===n})}}]),t}();a.defaultSources=["HighWire","DublinCore","DCTerms","Prism","BEPress","EPrints","WolterKluwer","Selectors","OpenGraph"],a.defaultTags=["pubmed_id","doi","title","publication_date","authors","abstract"],a.defaultSelectorsToRemoveFromInnerHTML=[".overlay"],e.exports={MetaExtractor:a,sources:o}},{"./DateParser":16,"./camelCase":17,"./sources":31}],19:[function(t,e,n){"use strict";var r=t("./Source"),o=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r),e}();o.prefix=["bepress","citation"],o.separator="_",e.exports=o},{"./Source":28}],20:[function(t,e,n){"use strict";var r=t("./Source"),o=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r),e}();o.defaultTags=["issn","journal_title","doi"],o.prefix="dcsext.wt",o.separator="_",o.issn="issn",o.journalTitle="name",o.doi="doi",e.exports=o},{"./Source":28}],21:[function(t,e,n){"use strict";var r=t("./Source"),o=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r),e}();o.defaultTags=["pubmed_id","doi","title","authors","abstract"],o.prefix="dcterms",o.authors="creator",o.abstract=["abstract","description"],o.journalTitle="publisher",o.issn="identifier.issn",e.exports=o},{"./Source":28}],22:[function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o=t("./Source"),i=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o),r(e,[{key:"getIssn",value:function(){for(var t=this.forCompact("issn"),e=0;e<t.length;e+=1){var n=t[e];if(!this.constructor.checkDoi(n))return n}}},{key:"sortScore",value:function(t,n){var r=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(r):void 0}(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"sortScore",this).call(this,t,n);if("doi"===t||"issn"===t){r*=10;var o=n.getAttribute("scheme");o&&o.toLowerCase()===t&&(r-=5);var i=this.clean(n.getAttribute("content"));i&&0===i.toLowerCase().indexOf(t+":")&&(r-=1)}return r}}]),e}();i.prefix="dc",i.doi=["identifier.doi","identifier"],i.authors=["creator","contributor"],i.publicationDate=["date","issued"],i.abstract=["abstract","description"],i.journalTitle="publisher",i.issn=["identifier.issn","identifier"],e.exports=i},{"./Source":28}],23:[function(t,e,n){"use strict";var r=t("./Source"),o=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r),e}();o.prefix="eprints",o.authors="creators_name",o.journalTitle=["publication","publisher"],e.exports=o},{"./Source":28}],24:[function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o=t("./Source"),i=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o),r(e,[{key:"forCompact",value:function(t){return this.buckets[t]=this.constructor.prioritizeEngMeta(this.buckets[t]),function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(r):void 0}(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"forCompact",this).call(this,t)}}],[{key:"prioritizeEngMeta",value:function(t){return[].concat(t.filter(function(t){return t.getAttribute&&"en"===t.getAttribute("xml:lang")}),t.filter(function(t){return!t.getAttribute||"en"!==t.getAttribute("xml:lang")}))}}]),e}();i.prefix="citation",i.separator="_",e.exports=i},{"./Source":28}],25:[function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o=t("./Source"),i=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o),r(e,null,[{key:"nodeTag",value:function(t){var n=t.getAttribute("property");return n?n.toLowerCase():function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(r):void 0}(e.__proto__||Object.getPrototypeOf(e),"nodeTag",this).call(this,t)}}]),e}();i.prefix="og",i.separator=":",i.authors=[],i.publicationDate="article:published_time",i.abstract="description",e.exports=i},{"./Source":28}],26:[function(t,e,n){"use strict";var r=t("./Source"),o=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r),e}();o.prefix="prism",o.publicationDate="publicationdate",o.journalTitle="publicationname",o.issn=["eissn","issn"],e.exports=o},{"./Source":28}],27:[function(t,e,n){(function(n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function o(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var i=t("./Source"),s=function(t){function e(t,r,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r));return i.options.selectors=i.options.selectors||{},i.buckets={},i.tags.forEach(function(t){i.options.selectors[t]&&(i.buckets[t]=[].slice.call(i.document.querySelectorAll(i.options.selectors[t])).map(function(t){if("META"===t.tagName)return t.content;n.NodeList&&!n.NodeList.prototype.forEach&&(n.NodeList.prototype.forEach=Array.prototype.forEach);var e=t.cloneNode(!0);return e.querySelectorAll(o).forEach(function(t){return t.parentNode.removeChild(t)}),e.innerHTML}))}),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,i),r(e,[{key:"forCompact",value:function(t){var e,n=this;if(!this.buckets[t])return[];var r=this.buckets[t].map(function(t){return n.clean(t)});if("authors"===t&&1===r.length){var i=r[0].split(",");return this.constructor.handleCommaSeparatedNameNotation(i)}return(e=[]).concat.apply(e,o(r))}},{key:"add",value:function(){this.added=this.added}}],[{key:"handleCommaSeparatedNameNotation",value:function(t){var e=t[0].split(/[\s;:.!?+&*\/%]+/).filter(function(t){return t}).length;return t.length>1&&e<2?this.joinFirstTwoItemsOfArray(t):t}},{key:"joinFirstTwoItemsOfArray",value:function(t){var e=[].concat(o(t));return e[0]=e[0]+","+e[1],e.splice(1,1),e}}]),e}();e.exports=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Source":28}],28:[function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o=t("../camelCase"),i=function(){function t(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.document=e,this.options=r,this.tags=this.options.tags||this.constructor.defaultTags,this.tagMap={},this.buckets={},this.tagOrder={},this.tags.forEach(function(t){n.buckets[t]=[],n.tagOrder[t]=[],[].concat(n.constructor[o(t)]).forEach(function(e){var r=n.constructor.tag(e);n.tagMap[r]=n.tagMap[r]||[],n.tagMap[r].push(t),n.tagOrder[t].push(r)})})}return r(t,[{key:"add",value:function(t){var e=this,n=this.constructor.nodeTag(t);(this.tagMap[n]||[]).forEach(function(n){t.getAttribute("content")&&e.buckets[n].push(t)})}},{key:"get",value:function(t){var e="get"+this.constructor.ucCamelCase(t);return"function"==typeof this[e]?this[e]():this.firstFor(t)}},{key:"getAuthors",value:function(){return this.forCompact("authors")}},{key:"getPublicationDate",value:function(){return this.forCompact("publication_date")}},{key:"getAbstract",value:function(){var t=this.forCompact("abstract");return t&&t.length?t.join(" ").trim():null}},{key:"getDoi",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"doi",e=this.forCompact(t),n=0;n<e.length;n+=1){var r=e[n];if(this.constructor.checkDoi(r))return r}}},{key:"firstFor",value:function(t){return this.forCompact(t)[0]}},{key:"forCompact",value:function(t){var e,n=this;if(!this.buckets[t])return[];"authors"!==t&&this.buckets[t].sort(function(e,r){return n.sortScore(t,e)-n.sortScore(t,r)});var r=this.buckets[t].map(function(e){var r=e.getAttribute?e.getAttribute("content"):e;return"authors"===t?n.clean(r).split(","):n.clean(r)});return(e=[]).concat.apply(e,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(r))}},{key:"sortScore",value:function(t,e){return(this.tagOrder[t]||"").indexOf(this.constructor.nodeTag(e))}},{key:"clean",value:function(t){return this.htmlDecode(t).replace(/[\n\t]+/g," ").replace(/\s+/g," ").trim()}},{key:"htmlDecode",value:function(t){if(!t)return"";var e=this.document.createElement("div");return e.innerHTML=t.replace(/<style.*?>.*?<\/style>|<script.*?>.*?<\/script>/g,"").replace(/(<span*>)/g,"$1 "),e.textContent}}],[{key:"checkDoi",value:function(t){return t.match(/\//g)}},{key:"tag",value:function(t){return[].concat(this.prefix).concat(t).join(this.separator)}},{key:"nodeTag",value:function(t){var e=t.getAttribute("name");return e?e.toLowerCase():"invalid"}},{key:"ucCamelCase",value:function(t){var e=o(t);return e.charAt(0).toUpperCase()+e.substr(1)}}]),t}();i.prefix=[],i.separator=".",i.defaultTags=["pubmed_id","doi","title","authors","publication_date","abstract"],i.pubmedId=["pubmed_id","pmid"],i.doi="doi",i.title="title",i.authors=["authors","author"],i.publicationDate=["publication_date","date"],i.abstract="abstract",i.journalTitle=["journal_title","journal_abbrev"],i.issn="issn",e.exports=i},{"../camelCase":17}],29:[function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o=t("./Source"),i=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o),r(e,[{key:"getCustomId",value:function(){var t=this.document.querySelector('meta[name="pbContext"]');if(t&&t.content){var e=new RegExp("journal\\:journal\\:(\\w+?)(?:\\W|$)").exec(t.content);if(e&&e.length>1)return e[1]}return null}}]),e}();e.exports=i},{"./Source":28}],30:[function(t,e,n){"use strict";var r=t("./Source"),o=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r),e}();o.prefix="wkhealth",o.separator="_",e.exports=o},{"./Source":28}],31:[function(t,e,n){"use strict";var r=t("./Source"),o=t("./HighWire"),i=t("./DublinCore"),s=t("./Prism"),a=t("./BEPress"),u=t("./EPrints"),c=t("./OpenGraph"),l=t("./WolterKluwer"),h=t("./DCTerms"),f=t("./Selectors"),d=t("./TandFonline"),p=t("./DCSext");e.exports={Source:r,HighWire:o,DublinCore:i,Prism:s,BEPress:a,EPrints:u,OpenGraph:c,WolterKluwer:l,DCTerms:h,Selectors:f,TandFonline:d,DCSext:p}},{"./BEPress":19,"./DCSext":20,"./DCTerms":21,"./DublinCore":22,"./EPrints":23,"./HighWire":24,"./OpenGraph":25,"./Prism":26,"./Selectors":27,"./Source":28,"./TandFonline":29,"./WolterKluwer":30}],32:[function(t,e,n){"use strict";var r=t("punycode"),o=t("./util");function i(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}n.parse=b,n.resolve=function(t,e){return b(t,!1,!0).resolve(e)},n.resolveObject=function(t,e){return t?b(t,!1,!0).resolveObject(e):e},n.format=function(t){o.isString(t)&&(t=b(t));return t instanceof i?t.format():i.prototype.format.call(t)},n.Url=i;var s=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,u=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(c),h=["%","/","?",";","#"].concat(l),f=["/","?","#"],d=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,g={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},v=t("querystring");function b(t,e,n){if(t&&o.isObject(t)&&t instanceof i)return t;var r=new i;return r.parse(t,e,n),r}i.prototype.parse=function(t,e,n){if(!o.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var i=t.indexOf("?"),a=-1!==i&&i<t.indexOf("#")?"?":"#",c=t.split(a);c[0]=c[0].replace(/\\/g,"/");var b=t=c.join(a);if(b=b.trim(),!n&&1===t.split("#").length){var w=u.exec(b);if(w)return this.path=b,this.href=b,this.pathname=w[1],w[2]?(this.search=w[2],this.query=e?v.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var _=s.exec(b);if(_){var k=(_=_[0]).toLowerCase();this.protocol=k,b=b.substr(_.length)}if(n||_||b.match(/^\/\/[^@\/]+@[^@\/]+/)){var C="//"===b.substr(0,2);!C||_&&m[_]||(b=b.substr(2),this.slashes=!0)}if(!m[_]&&(C||_&&!y[_])){for(var O,E,j=-1,P=0;P<f.length;P++){-1!==(T=b.indexOf(f[P]))&&(-1===j||T<j)&&(j=T)}-1!==(E=-1===j?b.lastIndexOf("@"):b.lastIndexOf("@",j))&&(O=b.slice(0,E),b=b.slice(E+1),this.auth=decodeURIComponent(O)),j=-1;for(P=0;P<h.length;P++){var T;-1!==(T=b.indexOf(h[P]))&&(-1===j||T<j)&&(j=T)}-1===j&&(j=b.length),this.host=b.slice(0,j),b=b.slice(j),this.parseHost(),this.hostname=this.hostname||"";var x="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!x)for(var I=this.hostname.split(/\./),S=(P=0,I.length);P<S;P++){var R=I[P];if(R&&!R.match(d)){for(var A="",L=0,q=R.length;L<q;L++)R.charCodeAt(L)>127?A+="x":A+=R[L];if(!A.match(d)){var D=I.slice(0,P),M=I.slice(P+1),U=R.match(p);U&&(D.push(U[1]),M.unshift(U[2])),M.length&&(b="/"+M.join(".")+b),this.hostname=D.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),x||(this.hostname=r.toASCII(this.hostname));var N=this.port?":"+this.port:"",H=this.hostname||"";this.host=H+N,this.href+=this.host,x&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!g[k])for(P=0,S=l.length;P<S;P++){var W=l[P];if(-1!==b.indexOf(W)){var G=encodeURIComponent(W);G===W&&(G=escape(W)),b=b.split(W).join(G)}}var B=b.indexOf("#");-1!==B&&(this.hash=b.substr(B),b=b.slice(0,B));var z=b.indexOf("?");if(-1!==z?(this.search=b.substr(z),this.query=b.substr(z+1),e&&(this.query=v.parse(this.query)),b=b.slice(0,z)):e&&(this.search="",this.query={}),b&&(this.pathname=b),y[k]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){N=this.pathname||"";var F=this.search||"";this.path=N+F}return this.href=this.format(),this},i.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",n=this.pathname||"",r=this.hash||"",i=!1,s="";this.host?i=t+this.host:this.hostname&&(i=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&o.isObject(this.query)&&Object.keys(this.query).length&&(s=v.stringify(this.query));var a=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||y[e])&&!1!==i?(i="//"+(i||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):i||(i=""),r&&"#"!==r.charAt(0)&&(r="#"+r),a&&"?"!==a.charAt(0)&&(a="?"+a),e+i+(n=n.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(a=a.replace("#","%23"))+r},i.prototype.resolve=function(t){return this.resolveObject(b(t,!1,!0)).format()},i.prototype.resolveObject=function(t){if(o.isString(t)){var e=new i;e.parse(t,!1,!0),t=e}for(var n=new i,r=Object.keys(this),s=0;s<r.length;s++){var a=r[s];n[a]=this[a]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var u=Object.keys(t),c=0;c<u.length;c++){var l=u[c];"protocol"!==l&&(n[l]=t[l])}return y[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!y[t.protocol]){for(var h=Object.keys(t),f=0;f<h.length;f++){var d=h[f];n[d]=t[d]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||m[t.protocol])n.pathname=t.pathname;else{for(var p=(t.pathname||"").split("/");p.length&&!(t.host=p.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),n.pathname=p.join("/")}if(n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,n.pathname||n.search){var g=n.pathname||"",v=n.search||"";n.path=g+v}return n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var b=n.pathname&&"/"===n.pathname.charAt(0),w=t.host||t.pathname&&"/"===t.pathname.charAt(0),_=w||b||n.host&&t.pathname,k=_,C=n.pathname&&n.pathname.split("/")||[],O=(p=t.pathname&&t.pathname.split("/")||[],n.protocol&&!y[n.protocol]);if(O&&(n.hostname="",n.port=null,n.host&&(""===C[0]?C[0]=n.host:C.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===p[0]?p[0]=t.host:p.unshift(t.host)),t.host=null),_=_&&(""===p[0]||""===C[0])),w)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,C=p;else if(p.length)C||(C=[]),C.pop(),C=C.concat(p),n.search=t.search,n.query=t.query;else if(!o.isNullOrUndefined(t.search)){if(O)n.hostname=n.host=C.shift(),(x=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=x.shift(),n.host=n.hostname=x.shift());return n.search=t.search,n.query=t.query,o.isNull(n.pathname)&&o.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!C.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var E=C.slice(-1)[0],j=(n.host||t.host||C.length>1)&&("."===E||".."===E)||""===E,P=0,T=C.length;T>=0;T--)"."===(E=C[T])?C.splice(T,1):".."===E?(C.splice(T,1),P++):P&&(C.splice(T,1),P--);if(!_&&!k)for(;P--;P)C.unshift("..");!_||""===C[0]||C[0]&&"/"===C[0].charAt(0)||C.unshift(""),j&&"/"!==C.join("/").substr(-1)&&C.push("");var x,I=""===C[0]||C[0]&&"/"===C[0].charAt(0);O&&(n.hostname=n.host=I?"":C.length?C.shift():"",(x=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=x.shift(),n.host=n.hostname=x.shift()));return(_=_||n.host&&C.length)&&!I&&C.unshift(""),C.length?n.pathname=C.join("/"):(n.pathname=null,n.path=null),o.isNull(n.pathname)&&o.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},i.prototype.parseHost=function(){var t=this.host,e=a.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},{"./util":33,punycode:4,querystring:7}],33:[function(t,e,n){"use strict";e.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},{}],34:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var i=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e&&(e.split(",").forEach(function(t){if(-1!==t.indexOf("=")){var e=t.split("="),o=r(e,2),i=o[0],s=o[1];n[n.trim(i)]=n.trim(s)}else n[n.trim(t)]=!0}),this.abstract=parseInt(this.abstract,10))}return o(t,[{key:"trim",value:function(t){return t.replace(/^\s+|\s+$/g,"")}}]),t}();n.default=i},{}],35:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=s(t("superagent")),i=s(t("./TimeLogger"));function s(t){return t&&t.__esModule?t:{default:t}}var a=function(){function t(e){var n=e.dtConfig,r=e.eventLogger,o=e.queryParams,i=e.tag,s=e.integrations;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.dtConfig=n,this.switches={},this.eventLogger=r,this.queryParams=o,this.res={},this.tag=i,this._integrations=s,this._dtAdded=!1}return r(t,[{key:"addDt",value:function(){return!this._dtAdded&&(!(!this.dtConfig||!this.switches.dt||this.switches.gdpr||!this.switches.isUS)&&(this.dtConfig.dmd&&this._addDmdIframe(),this.dtConfig.lhk&&this._makeLhkReq(),this._integrations.loop(),this._dtAdded=!0,!0))}},{key:"_addDmdIframe",value:function(){var t=this,e=document.createElement("iframe");if(e.setAttribute("style","display:none!important"),"function"!=typeof e.getAttribute)return!1;var n=Date.now(),r="?client-origin="+window.location.origin+"&timestamp="+n;return this.dtConfig.dmd.permittedOrigin=""+this.dtConfig.dmd.origin,e.src=""+this.dtConfig.dmd.permittedOrigin+this.dtConfig.dmd.path+r,document.body.appendChild(e),window.addEventListener("message",function(e){return t.dmdPostMessageHandler(e)},!1),!0}},{key:"_makeLhkReq",value:function(){var t=this;o.default.get(this.dtConfig.lhk.api).withCredentials().end(function(e,n){t.eventLogger.log({},{lhk:n.body})})}},{key:"dmdPostMessageHandler",value:function(t){t.origin===this.dtConfig.dmd.permittedOrigin&&(this.res=t.data,i.default.log("dt"),this.eventLogger.dmdObj=this.dmdObj(),i.default.times.recos&&this.eventLogger.log({},{dmd:this.dmdObj()}))}},{key:"dmdObj",value:function(){if(!this.dtConfig||!this.dtConfig.dmd||!this.switches.dt)return!1;for(var t={url:document.location.href,title:document.title,article:this.queryParams(),referrer:document.referrer,time:new Date,recos:[],iframe:{data:this.res,iframeResponse:i.default.times.dt,recosVisible:i.default.times.recos}},e=document.getElementsByClassName(this.tag+"-widget-list-item__link"),n=0;n<e.length;n++){var r=e[n];t.recos.push(r.getAttribute("data-"+this.tag+"-id"))}return t}}]),t}();n.default=a},{"./TimeLogger":43,superagent:11}],36:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=t("superagent"),s=(r=i)&&r.__esModule?r:{default:r};var a=function(){function t(e){var n=e.config;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tag=n.tag,this.version=n.version,this.relevancyUrl=n.relevancyUrl,this.eventsEndpoint="/events",this.swoopObj={},this.dmdObj={},this.switches={},this.stack=[],this.concurrent=0,this._stackInterval=0,this._stackInProgress=!1,this.hasAdBlock=null}return o(t,[{key:"log",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments[2];this.stack.push({events:t,misc:n,cb:r}),this._stackInterval||(this._log(),this._stackInterval=setInterval(function(){!e._stackInProgress&&e.stack.length&&e._log()},200))}},{key:"_log",value:function(){var t=this;this._stackInProgress=!0;var e=this.stack.pop(),n=e.events,r=e.misc,o=e.cb;return r.switches=this.switches||{},this.concurrent+=1,s.default.post(this.relevancyUrl+this.eventsEndpoint).set(this.tag+"-widget-version",this.version).withCredentials().send({events:n,misc:r}).end(function(e,n){t.concurrent-=1,t._stackInProgress=!1,"function"==typeof o&&o(n)})}}]),t}();n.default=a},{superagent:11}],37:[function(t,e,n){(function(e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=t("./TimeLogger"),s=(r=i)&&r.__esModule?r:{default:r};function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var u=function(){function t(e){var n=e.config,r=e.eventLogger;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tag=n.tag,this.version=n.version,this.testID=null,this.journalId=null,this.articleId=null,this.contentCategory=null,this.elements={},this.eventsStoreKey=this.tag+"SentEvents",this.attributes={articleId:"data-"+this.tag+"-id",journalId:"data-"+this.tag+"-journal-id",contentCategory:"data-"+this.tag+"-content-category",sponsored:"data-"+this.tag+"-sponsored",campaignId:"data-"+this.tag+"-campaign-id",ct:"data-"+this.tag+"-ct"},this.selectors={organic:"a[data-"+this.tag+'-sponsored="false"]',sponsored:"a[data-"+this.tag+'-sponsored="true"]'},this._eventLogger=r}return o(t,[{key:"impression",value:function(t,e){var n=this,r={},o=[],i=[];t.forEach(function(t){for(var e=n.nodes("organic",t),s=0;s<e.length;s++){o.push(n.params(e[s]));var a=e[s].getAttribute(n.attributes.articleId);r[a]=e[s].getAttribute(n.attributes.ct)}for(var u=n.nodes("sponsored",t),c=0;c<u.length;c++){i.push(n.params(u[c]));var l=u[c].getAttribute(n.attributes.articleId);r[l]=u[c].getAttribute(n.attributes.ct)}});var a={"organic-impressions":o,"sponsored-impressions":i};if(!this.hasSentImpressionsEvents(a)){var u=o.length+i.length<e;this._eventLogger.log(a,{"loading-times":s.default.times,dmd:this._eventLogger.dmdObj,swoop:this._eventLogger.swoopObj,hasAdBlock:this._eventLogger.hasAdBlock,testID:this.testID,widgetVersion:this.version,websiteId:this.journalId,articleId:this.articleId,ct:r,hasInsufficientRecommendations:u})}}},{key:"click",value:function(t){var e=t.getAttribute(this.attributes.articleId),n=t.getAttribute(this.attributes.ct),r="true"===t.getAttribute(this.attributes.sponsored)?"sponsored":"organic",o={dt:this._eventLogger.dmdObj,swoop:this._eventLogger.swoopObj,testID:this.testID,ct:a({},e,n)};s.default.times.timeToClickStart&&(s.default.log("timeToClick","timeToClickStart"),o.ttc=s.default.times.timeToClick),this._eventLogger.log(a({},r+"-recommendations",[this.params(t)]),o)}},{key:"hasSentImpressionsEvents",value:function(t){var n=JSON.stringify(t);return e[this.eventsStoreKey]||(e[this.eventsStoreKey]=[]),-1!==e[this.eventsStoreKey].indexOf(n)||(e[this.eventsStoreKey].push(n),!1)}},{key:"nodes",value:function(t,e){return this.elements[e].querySelectorAll(this.selectors[t])}},{key:"params",value:function(t){return{from_journal_id:this.journalId,from_article_id:this.articleId,from_content_category:this.contentCategory,to_journal_id:t.getAttribute(this.attributes.journalId),to_article_id:t.getAttribute(this.attributes.articleId),to_content_category:t.getAttribute(this.attributes.contentCategory),campaign_id:t.getAttribute(this.attributes.campaignId)}}},{key:"switches",set:function(t){this._eventLogger.switches=t}}]),t}();n.default=u}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./TimeLogger":43}],38:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o=function(){function t(e){var n=e.eventLogger,r=e.tag;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.prConsent=null,this.trConsent=null,this.gaConsent=null,this.gaClientId=null,this.gaConsentInGdpr=null,this.newClientId=!1,this.gdpr=!0,this.isUS=!1,this.gaCode="UA-139886559-1",this.tag=r,this.eventLogger=n,this.sessionCookieName=this.tag+"-disable-gdpr-ga-popup",this.flag="cf_widget_j",this.journalId=null,this.widgetIsLoaded=!1}return r(t,[{key:"addGaTrackingCode",value:function(t,e,n){var r=this;t&&(this.gaCode=t),e&&(this.flag=e),this._addGaTrackingCode(function(){r.gdpr&&!r.gaConsent?navigator.cookieEnabled&&-1!==document.cookie.indexOf(r.sessionCookieName)||("function"==typeof n?n():r._askForGaConsent()):r.newClientId?r._registerGaConsent(!0,function(t){t||r._gaTrackPageView()}):r._gaTrackPageView()})}},{key:"_addGaTrackingCode",value:function(t){var e,n,r,o,i,s,a,u=this;e=window,n=document,r="script",o="//www.google-analytics.com/analytics.js",i="ga",e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){return(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,s=n.createElement(r),a=n.getElementsByTagName(r)[0],s.async=1,s.src=o,a.parentNode.insertBefore(s,a),this.gaClientId?ga("create",this.gaCode,"auto",{storage:"none",name:"tmdWidget",clientId:this.gaClientId}):ga("create",this.gaCode,"auto",{storage:"none",name:"tmdWidget"}),ga("set","anonymizeIp",!0),ga(function(){"function"==typeof ga.getAll&&ga.getAll().forEach(function(e){"tmdWidget"===e.get("name")&&(u.gaClientId||(u.gaClientId=e.get("clientId"),u.newClientId=!0),t())})})}},{key:"_gaTrackPageView",value:function(){"cf_widget"===this.flag.substring(0,9)?ga("tmdWidget.send","pageview",window.location.hostname+"/"+this.journalId):ga("tmdWidget.send","pageview")}},{key:"_askForGaConsent",value:function(){document.getElementsByClassName(this.tag+"-widget-cookie-notification").length&&(this._hideProgress(),document.getElementsByClassName(this.tag+"-widget-cookie-notification")[0].setAttribute("style","display: block!important"))}},{key:"_registerGaConsent",value:function(t){var e=this,n=function(){var n=e.flag;"cf_widget"===e.flag.substring(0,9)&&(n=""+e.flag+e.journalId),e.eventLogger.log({},{gdprGaConsent:{gdpr:e.gdpr,gaClientId:e.gaClientId,gaCode:e.gaCode,gaConsent:e.gaConsent,gaConsentInGdpr:e.gaConsentInGdpr,flag:n}},function(n){n&&n.ok?(e.gaConsent&&e._gaTrackPageView(),"function"==typeof t&&t(!1),e.gdpr&&(document.cookie=e.sessionCookieName+"=1;path=/")):n&&n.ok||"function"==typeof t&&t({error:"other"})})};if(!this.gdpr&&this.eventLogger.concurrent>0)var r=setInterval(function(){0===e.eventLogger.concurrent&&(n(),clearInterval(r))},500);else n()}},{key:"_handleGaConsentError",value:function(){var t=this;this._hideConsentFooter(),clearTimeout(this._handleGaConsentErrorTimeout),this._handleGaConsentErrorTimeout=setTimeout(function(){t._askForGaConsent()},500)}},{key:"_hideConsentFooter",value:function(){var t=document.getElementsByClassName(this.tag+"-widget-cookie-notification");if(t)for(var e=0;e<t.length;e++)t[e]&&"function"==typeof t[e].setAttribute&&t[e].setAttribute("style","display: none!important")}},{key:"_showProgress",value:function(){var t=this;document.querySelectorAll("."+this.tag+"-widget-cookie-notification button").forEach(function(t){return t.style.display="none"});var e=document.querySelectorAll("."+this.tag+"-widget-cookie-notification span")[1];clearInterval(this._showProgressInterval),this._showProgressDots=1,this._showProgressInterval=setInterval(function(){for(var n="Saving",r=0;r<t._showProgressDots;r++)n+=".";e&&(e.innerHTML=n),t._showProgressDots+=1,t._showProgressDots>3&&(t._showProgressDots=1)},500)}},{key:"_hideProgress",value:function(){document.querySelectorAll("."+this.tag+"-widget-cookie-notification button").forEach(function(t){return t.style.display="inline-block"});var t=document.querySelectorAll("."+this.tag+"-widget-cookie-notification span")[1];clearInterval(this._showProgressInterval),t.innerHTML=""}},{key:"_clearSessionCookie",value:function(){document.cookie=this.sessionCookieName+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"}},{key:"setGaConsent",value:function(t,e){var n=this,r=e;return"function"!=typeof r&&(r=function(t){t?n._handleGaConsentError():n._hideConsentFooter()}),navigator.cookieEnabled?(this.gaConsent=!0===t,this._showProgress(),this._registerGaConsent(r)):r({error:"cookie"})}},{key:"setPrConsent",value:function(t,e,n){return navigator.cookieEnabled?(this.prConsent=!0===t,this.trConsent=!0===e,this.eventLogger.log({},{gdprPrConsent:{gdpr:this.gdpr,prConsent:this.prConsent,trConsent:this.trConsent}},function(t){"function"==typeof n&&(t.ok?n(!1):t.ok||n({error:"other"}))})):n({error:"cookie"})}},{key:"switches",set:function(t){t&&(this.isUS=!!t.isUS),t&&null!==t.gdpr&&(this.gdpr=t.gdpr),t&&t.gaCode&&(this.gaCode=t.gaCode),t&&t.mainCookie&&t.mainCookie.ga?(this.gaConsent=!!t.mainCookie.ga.consent,this.gaClientId=t.mainCookie.ga.clientId):this.gdpr?this.gaConsent=!1:this.gaConsent=!0,t&&t.mainCookie&&t.mainCookie.pr?(this.prConsent=!!t.mainCookie.pr.consent,this.trConsent=!!t.mainCookie.pr.tr):this.gdpr?(this.prConsent=!1,this.trConsent=!1):(this.prConsent=!0,this.trConsent=!0),t&&t.mainCookie&&t.mainCookie.gdprGaConsent&&(this.gaConsentInGdpr=!0),t&&void 0!==t.mainCookieWasCleared&&!0===t.mainCookieWasCleared&&this._clearSessionCookie()}}]),t}();n.default=o},{}],39:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=d(t("./WebsiteProperties")),i=d(t("./Events")),s=d(t("./EventLogger")),a=d(t("./Recommendations")),u=d(t("./WidgetInstances")),c=d(t("./WidgetIntegrations")),l=d(t("./Gdpr")),h=d(t("./Dt")),f=d(t("./TimeLogger"));function d(t){return t&&t.__esModule?t:{default:t}}var p=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.config=e,this.tag=e.tag,window.trendmdGlobalState=window.trendmdGlobalState||{},window.trendmdGlobalState.cache=window.trendmdGlobalState.cache||{},window.trendmdGlobalState.urlLocked=window.trendmdGlobalState.urlLocked||new Set,this._getOptions(),this.eventLogger=null,this.gdprInstance=null,this.widgetInstances=null,this.options&&this.register()}return r(t,[{key:"register",value:function(t){var e=t||this.options;if(e){f.default.init();var n=new o.default({apiUrl:this.config.apiUrl,options:e,version:this.config.version,tag:this.config.tag});this.eventLogger||(this.eventLogger=new s.default({config:this.config}));var r=new c.default({config:this.config,eventLogger:this.eventLogger}),d=new i.default({config:this.config,eventLogger:this.eventLogger}),p=new a.default({config:this.config,websiteProperties:n,options:e});p.run(),this.gdprInstance||(this.gdprInstance=new l.default({tag:this.config.tag,eventLogger:this.eventLogger}));var g=new h.default({dtConfig:this.config.dtConfig,eventLogger:this.eventLogger,queryParams:function(){return p.queryParams()},tag:this.config.tag,integrations:r});this.widgetInstances=new u.default({config:this.config,events:d,websiteProperties:n,options:e,recommendations:p,integrations:r,gdpr:this.gdprInstance,dt:g}),this.widgetInstances.init()}}},{key:"gdpr",value:function(t){var e=this;if(this.gdprInstance)"function"==typeof t&&t();else{f.default.init();var n=new o.default({apiUrl:this.config.apiUrl,options:{journal_id:1},version:this.config.version,tag:this.config.tag});this.eventLogger||(this.eventLogger=new s.default({config:this.config})),this.gdprInstance||(this.gdprInstance=new l.default({tag:this.config.tag,eventLogger:this.eventLogger})),Promise.resolve(n.get()).then(function(n){e.gdprInstance.journalId=n.id,e.gdprInstance.switches=n.switches,e.eventLogger.switches=n.switches,"function"==typeof t&&t()})}return this.gdprInstance}},{key:"_getURLParam",value:function(t){var e=new RegExp("[?|&]"+t+"=([^&;]+?)(&|#|;|$)").exec(window.location.search),n=!1;return e&&e.length&&(n=e[1].replace(/\+/g,"%20"),n=decodeURIComponent(e[1])),n}},{key:"_getOptions",value:function(){var t=this,e=void 0,n=document.currentScript||function(){for(var e=document.getElementsByTagName("script"),n="",r=0;r<e.length;r++){var o=e[r];o.getAttribute("data-"+t.tag+"config")&&(n=o)}return n}();if(n&&(e=n.getAttribute("data-amp")),e){this.options={title:this._getURLParam("title"),doi:this._getURLParam("doi"),journal_id:this._getURLParam("journalId"),issn:this._getURLParam("issn"),pubmed_id:this._getURLParam("pubmed"),url:this._getURLParam("url"),custom:this._getURLParam("custom"),element:"#"+this.tag+"-suggestions"},window.parent.postMessage({sentinel:"amp",type:"embed-size",height:document.body.scrollHeight},"*");for(var r=document.getElementsByClassName(this.tag+"-widget-list-item__link"),o=0;o<r.length;o++)r[o].setAttribute("target","_blank")}else n&&(this.options=n.getAttribute("data-"+this.config.tag+"config"),this.options&&(this.options=this.options.replace(/'/g,'"'),this.options=JSON.parse(this.options)))}}]),t}();n.default=p},{"./Dt":35,"./EventLogger":36,"./Events":37,"./Gdpr":38,"./Recommendations":40,"./TimeLogger":43,"./WebsiteProperties":44,"./WidgetInstances":46,"./WidgetIntegrations":47}],40:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=u(t("url")),i=u(t("superagent")),s=t("trendmd-meta-extractor"),a=u(t("./RequestCache"));function u(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e){var n=e.config,r=e.options,o=e.websiteProperties;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.apiUrl=n.apiUrl,this.tag=n.tag,this.version=n.version,this.options=r,this.websiteProperties=o,this.website={}}return r(t,[{key:"run",value:async function(){var t=this,e=await this.websiteProperties.get(),n=e.widgets;this.website=e,this.missingEndpoint="/journals/"+e.id+"/missing",this.articlesEndpoint="/journals/"+e.id+"/articles",this.extractor=new s.MetaExtractor(document,e);var r=this.queryParams();if(this.isMissing(r))this.missing();else{this.createExecuted=!1,this.updateExecuted=!1,this.sponsoredRequestPromises={},this.organicRequestPromises={};var o=0;n.forEach(function(e){t.sponsoredRequestPromises[e.id]=new Promise(function(n,i){t.getSimilarArticle("sponsored",Object.assign({},r,{offset:o,boostedRecommendationsLimit:e.boostedRecommendationsLimit,recommendationsType:e.recommendationsType,numberOfRecommendations:e.numberOfRecommendations,sponsoredLimit:e.sponsoredLimit,titleSize:e.titleSize,fontSize:e.fontSize,titleWording:e.titleWording,logoStyle:e.logoStyle,columns:e.columns}),n,i)}),t.organicRequestPromises[e.id]=new Promise(function(n,i){t.getSimilarArticle("nonsponsored",Object.assign({},r,{offset:o,boostedRecommendationsLimit:e.boostedRecommendationsLimit,recommendationsType:e.recommendationsType,numberOfRecommendations:e.numberOfRecommendations,sponsoredLimit:e.sponsoredLimit,titleSize:e.titleSize,fontSize:e.fontSize,titleWording:e.titleWording,logoStyle:e.logoStyle,columns:e.columns}),n,i)}),"both"===e.recommendationsType?o+=Math.floor(e.numberOfRecommendations/2):o+=e.numberOfRecommendations})}}},{key:"getSponsored",value:async function(t){return this.sponsoredRequestPromises[t]}},{key:"getNonSponsored",value:async function(t){return this.organicRequestPromises[t]}},{key:"getSimilarArticle",value:function(t,e,n,r){var o=this,i=Object.assign({},e,"nonsponsored"===t&&{timestamp:this.website.updatedAt});this.article({endpoint:"/journals/"+this.website.id+"/similar-"+t,params:this.website.findArticlesByUrlOnly?{url:i.url}:i,type:t},function(e,i){if(e&&e.timeout)n({timeout:!0});else{if(403!==i.status)return 404===i.status?(o.createExecuted||(o.createExecuted=!0,o.create()),void r({status:i.status,error:e})):void(i.status>=400||(i.type=t,n(i)));r({status:i.status,error:e})}})}},{key:"article",value:function(t,e){var n=t.endpoint,r=t.params,o="nonsponsored"===t.type?this.apiUrl.nonSponsored:this.apiUrl.sponsored;return i.default.get(o+n).set(this.tag+"-widget-version",this.version).timeout(3e4).withCredentials().query(r).use(a.default).end(e)}},{key:"create",value:function(t){i.default.post(this.apiUrl.sponsored+this.articlesEndpoint).set(this.tag+"-widget-version",this.version).timeout(3e4).send(this.storeParams()).end(t)}},{key:"missing",value:function(){this.nonMissingUrl()||i.default.post(this.apiUrl.sponsored+this.missingEndpoint).set(this.tag+"-widget-version",this.version).timeout(3e4).send({url:this.options.url||window.location.href}).end()}},{key:"queryParams",value:function(){return this.params("pubmed_id","doi","title","authors","url","publication_year","publication_month")}},{key:"storeParams",value:function(){return this.params("staging","pubmed_id","doi","title","authors","url","publication_year","publication_month","abstract")}},{key:"params",value:function(){for(var t=this,e={},n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];if(-1!==r.indexOf("url")){var s=o.default.parse(window.location.href),a=s;this.options.url&&((a=o.default.parse(this.options.url)).protocol||(a.protocol=s.protocol),a.host||(a.host=s.host)),e.url=o.default.format(a)}return-1!==r.indexOf("staging")&&(e.staging=this.website.staging),r.forEach(function(n){"url"!==n&&"staging"!==n&&(e[n]=t.checkParam(n,t.options[n]||t.extractor[n]))}),e}},{key:"checkParam",value:function(t,e){return"publication_year"===t?e>=1900&&e<=2100?e:null:"publication_month"===t?e>=1&&e<=12?e:null:e}},{key:"isMissing",value:function(t){return this.missingParameters(t)}},{key:"missingParameters",value:function(t){return!t.title&&!t.doi&&!t.pubmed_id}},{key:"nonMissingUrl",value:function(){return this.fileUrl()||this.googleCacheUrl()}},{key:"fileUrl",value:function(){return(this.options.url||window.location.href).match(/^file:\/\//)}},{key:"googleCacheUrl",value:function(){return(this.options.url||window.location.href).match(/^http:\/\/webcache\.googleusercontent\.com\/search/)}}]),t}();n.default=c},{"./RequestCache":42,superagent:11,"trendmd-meta-extractor":18,url:32}],41:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.widgetsInfo={},e.forEach(function(t){var e=null,r=new Promise(function(t){e=t}),o=null,i=new Promise(function(t){o=t});n.widgetsInfo[t.widgetId]={numberOfRecommendations:t.numberOfRecommendations,recommendationsType:t.recommendationsType,sponsoredLimit:t.sponsoredLimit,recommendations:{sponsored:[],nonsponsored:[]},readyPromise:r,onReady:e,loadedPromise:i,onLoaded:o,responsesReceived:0,container:null}}),this.maxWidgetId=e.length-1}return r(t,[{key:"balanceRecommendations",value:async function(t){var e=this.widgetsInfo[t],n=e.recommendations.sponsored.length,r=e.recommendations.nonsponsored.length,o=[],i=[];if("sponsored"===e.recommendationsType){var s=e.numberOfRecommendations-n;o=await this.getExtraRecommendations(t,"sponsored",s)}else if("nonsponsored"===e.recommendationsType){var a=e.numberOfRecommendations-r;i=await this.getExtraRecommendations(t,"nonsponsored",a)}else{var u=e.sponsoredLimit-n,c=e.numberOfRecommendations-e.sponsoredLimit-r;c+=u-(o=await this.getExtraRecommendations(t,"sponsored",u)).length,i=await this.getExtraRecommendations(t,"nonsponsored",c)}var l=e.container.querySelectorAll("ol.trendmd-widget-list"),h=document.createDocumentFragment(),f=document.createDocumentFragment();e.recommendations.sponsored.forEach(function(t){h.appendChild(t)}),o.forEach(function(t){h.appendChild(t)}),e.recommendations.nonsponsored.forEach(function(t){f.appendChild(t)}),i.forEach(function(t){f.appendChild(t)}),l.forEach(function(t,e){t.innerHTML="",0===e&&t.appendChild(f),e===l.length-1&&t.appendChild(h)}),e.onReady(e.container.innerHTML)}},{key:"getExtraRecommendations",value:async function(t,e,n){var r=this,o=async function(t){if(t>r.maxWidgetId)return[];await r.widgetsInfo[t].loadedPromise;var o=r.widgetsInfo[t].recommendations[e],i=[];return o.length>0&&(i=o.slice(0,n),r.widgetsInfo[t].recommendations[e]=o.slice(n)),i};if(0===n)return[];var i=[];return(i=await o(t+1)).length<n&&(i=i.concat(await o(t+2))),i}},{key:"onRecommendationsReceived",value:function(t,e,n){var r=document.createElement("html"),o=this.widgetsInfo[t];r.innerHTML=e;var i=r.querySelectorAll("li.trendmd-widget-list-item");o.recommendations[n]=Array.from(i),o.responsesReceived+=1,null!==o.container&&"sponsored"!==n||(o.container=r),2===o.responsesReceived&&this.onLoaded(t)}},{key:"onLoaded",value:async function(t){this.widgetsInfo[t].onLoaded();for(var e=[],n=0;n<t;n++)e.push(this.widgetsInfo[n].readyPromise);await Promise.all(e),this.balanceRecommendations(t)}},{key:"onError",value:async function(t){this.widgetsInfo[t].onReady()}},{key:"getBalancedRecommendations",value:async function(t){return this.widgetsInfo[t].readyPromise}}]),t}();n.default=o},{}],42:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=i(t("cache-service-cache-module")),o=i(t("superagent-cache-plugin"));function i(t){return t&&t.__esModule?t:{default:t}}var s=new r.default({storage:"",defaultExpiration:900,verbose:!1}),a=(0,o.default)(s);n.default=a},{"cache-service-cache-module":1,"superagent-cache-plugin":8}],43:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.times={}}return r(t,[{key:"init",value:function(){this.times.start||(this.times.start=new Date)}},{key:"log",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"start";this.times.start||console.error("TimeLogger: can't log "+t+", logger isn't initilized yet"),this.times[t]=new Date-this.times[e]}}]),t}());n.default=o},{}],44:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=u(t("superagent")),i=t("trendmd-meta-extractor"),s=u(t("./TimeLogger")),a=u(t("./RequestCache"));function u(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e){var n=this,r=e.apiUrl,u=e.options,c=e.version,l=e.tag;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.apiUrl=r,this.options=u,this.version=c,this.tag=l,this.requestPromise=new Promise(function(t,e){var r=void 0,u=void 0;if(n.options.journal_id)r="/journals/"+n.options.journal_id+"/selectors",u={};else{r="/journals/identification";var c=new i.MetaExtractor(window.document,{sources:["HighWire","DCSext","DublinCore","DCTerms","Prism","BEPress","EPrints","WolterKluwer","TandFonline"],tags:["doi","issn","journal_title","custom_id"]});u={doi:c.doi,issn:c.issn,url:n.options.url||window.location.href,custom_id:n.options.custom_id||c.custom_id}}window.trendmdGlobalState.journal?t(window.trendmdGlobalState.journal):o.default.get(n.apiUrl.sponsored+r).set(n.tag+"-widget-version",n.version).withCredentials().query(u).use(a.default).end(function(n,o){"/journals/identification"===r?s.default.log("identification"):s.default.log("selectors"),n||o.error?e(n||o.error):(window.trendmdGlobalState.journal=o.body.journal,t(o.body.journal))})})}return r(t,[{key:"get",value:async function(){return this.requestPromise}}]),t}();n.default=c},{"./RequestCache":42,"./TimeLogger":43,superagent:11,"trendmd-meta-extractor":18}],45:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=s(t("./WidgetPosition")),i=s(t("./ArticleHeader"));function s(t){return t&&t.__esModule?t:{default:t}}var a=function(){function t(e){var n=e.config,r=e.options,i=e.events,s=e.recommendations,a=e.instanceOptions,u=e.integrations,c=e.gdpr,l=e.dt,h=e.recommendationsBalancer;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tag=n.tag,this.widgetOptionsId=a.id,this.widgetId=a.widgetId,this.mainWidget=0===a.widgetId,this.recommendations=s,this.events=i,this.recommendationsBalancer=h,this.position=new o.default({config:n,options:r,eventLogger:this.events._eventLogger,instanceOptions:a,integrations:u,gdpr:c,dt:l})}return r(t,[{key:"init",value:function(){var t=this;return this.position.define(),Promise.race([this.recommendations.getSponsored(this.widgetOptionsId),this.recommendations.getNonSponsored(this.widgetOptionsId)]).then(async function(e){var n=e.headers,r=e.text,o=e.type;if(e.timeout)return Promise.reject(new Error("timeout"));var s=new i.default(n[t.tag+"-article"]),a=void 0,u=void 0;t.events.testID=n["x-testid"],t.events.articleId=s.id;try{await t.position.isDefinedPromise}catch(t){return console.error("WidgetPosition error: "+t),Promise.reject()}t.recommendationsBalancer.onRecommendationsReceived(t.widgetId,r,o),t.position.setFirstResponse({type:o,text:r,articleHeader:s}),a="sponsored"===o?t.recommendations.getNonSponsored(t.widgetOptionsId):t.recommendations.getSponsored(t.widgetOptionsId);var c=await a;t.recommendationsBalancer.onRecommendationsReceived(t.widgetId,c.text||"",c.type);try{u=await t.recommendationsBalancer.getBalancedRecommendations(t.widgetId)}catch(t){return console.error("WidgetPosition error: "+t),Promise.reject()}return t.position.setSecondResponse(Object.assign({},c,{text:u})),t.position.onClick(function(e){return t.events.click(e)}),t.events.elements[t.widgetOptionsId]=t.position.widgetContainer,c.timeout?Promise.reject(new Error("timeout")):Promise.resolve(t.widgetOptionsId)}).catch(function(e){if(t.recommendationsBalancer.onError(t.widgetId),e){var n=e.error;return Promise.reject(n)}return Promise.reject(e)})}}]),t}();n.default=a},{"./ArticleHeader":34,"./WidgetPosition":48}],46:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=s(t("./Widget")),i=s(t("./RecommendationsBalancer"));function s(t){return t&&t.__esModule?t:{default:t}}var a=function(){function t(e){var n=e.config,r=e.options,o=e.websiteProperties,i=e.events,s=e.recommendations,a=e.integrations,u=e.gdpr,c=e.dt;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.config=n,this.options=r,this.websiteProperties=o,this.events=i,this.recommendations=s,this.integrations=a,this.gdpr=u,this.dt=c,this.instancesOptions=[],this.instances=[]}return r(t,[{key:"init",value:async function(){var t=this,e=void 0;try{e=await this.websiteProperties.get()}catch(t){return void console.error("WebsiteProperties error: "+t)}this.events.journalId=e.id,this.events.contentCategory=e.category,this.events.switches=e.switches||{},this.gdpr.journalId=e.id,this.gdpr.switches=e.switches||{},this.dt.switches=e.switches||{},this.integrations._websiteId=e.id;var n=new i.default(e.widgets),r=e.widgets.map(function(r){var i=Object.assign({},r,{websiteId:e.id,switches:e.switches,hideWidget:e.hideExtraWidgets}),s=new o.default({config:t.config,options:t.options,events:t.events,recommendations:t.recommendations,instanceOptions:i,integrations:t.integrations,gdpr:t.gdpr,dt:t.dt,recommendationsBalancer:n});return t.instances.push(s),t.instancesOptions.push(i),s.init()}),s=await Promise.all(r.map(function(t){return t.catch(function(){return!1})})).then(function(t){return t.filter(function(t){return!1!==t})}),a=e.widgets.filter(function(t){return-1!==s.indexOf(t.id)}).reduce(function(t,e){return t+e.numberOfRecommendations},0);this.gdpr.widgetIsLoaded&&this.gdpr.addGaTrackingCode(),this.events.impression(s,a)}}]),t}();n.default=a},{"./RecommendationsBalancer":41,"./Widget":45}],47:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=s(t("superagent")),i=s(t("./TimeLogger"));function s(t){return t&&t.__esModule?t:{default:t}}var a=function(){function t(e){var n=e.config,r=e.eventLogger;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.apiUrl=n.apiUrl,this.tag=n.tag,this.version=n.version,this.integrationsEndpoint="/integrations",this.dataset=null,this._swoopInserted=!1,this._loopInitialized=!1,this._articleId=null,this._websiteId=null,this._swoopWebsiteId=null,this._pubn=null,this._inn=null,this._detected=null,this._initialized=!1,this._eventLogger=r}return r(t,[{key:"init",value:function(t){var e=t.dataset,n=t.articleId;this._initialized||(this._initialized=!0,this._articleId=n,this.dataset=e,this.swoopParseSimilarHtml())}},{key:"swoopParseSimilarHtml",value:function(){try{var t=this.dataset.trendmdSwoop,e=window.atob(t),n=JSON.parse(e),r=n.swi,o=n.pubn,i=n.inn;return this._swoopWebsiteId=r,this._pubn=o,this._inn=i,this._swoopAppend()}catch(t){return null}}},{key:"_loop",value:function(){this._swoopInserted||setTimeout(this._request.bind(this),5e3)}},{key:"loop",value:function(){return this._loopInitialized?null:(this._loopInitialized=!0,this._loop())}},{key:"_swoopAppend",value:function(){if(this._swoopWebsiteId&&this._pubn&&!this._swoopInserted){var t=document.createElement("script");return t.src="https://ardrone.swoop.com/js/spxw.js",t.id="swoop_sdk",t.dataset.domain=this._swoopWebsiteId,t.dataset.npi=this._pubn,document.getElementsByTagName("body")[0].appendChild(t),this._swoopLog(),this._swoopInserted=!0,!0}return!1}},{key:"_swoopLog",value:function(){return i.default.times.recos?this._eventLogger.log({},{swoop:this._swoopData()}):(this._eventLogger.swoopObj=this._swoopData(),null)}},{key:"_swoopData",value:function(){return{articleId:this._articleId,websiteId:this._websiteId,inn:this._inn,swoopId:this._swoopWebsiteId}}},{key:"_integration",value:function(t){return o.default.get(this.apiUrl.sponsored+this.integrationsEndpoint).set(this.tag+"-widget-version",this.version).withCredentials().end(t)}},{key:"_request",value:function(){var t=this;this._integration(function(e,n){if(e)return null;var r=n.body,o=r.inn,i=r.pubn,s=r.detected;return t._inn=o,t._pubn=i,t._detected=s,t._detected&&t._swoopWebsiteId&&!t._swoopAppend()?t._loop():null})}}]),t}();n.default=a},{"./TimeLogger":43,superagent:11}],48:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=a(t("domready")),s=a(t("./TimeLogger"));function a(t){return t&&t.__esModule?t:{default:t}}i.default.domready=i.default;var u=function(){function t(e){var n=e.config,r=e.options,o=e.instanceOptions,i=e.eventLogger,s=e.integrations,a=e.gdpr,u=e.dt;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var c=o.selectors,l=o.placementSelector,h=o.placementPosition,f=o.wrapperStart,d=o.wrapperEnd,p=o.numberOfRecommendations;this.numberOfRecommendations=p,this.mainWidget=0===o.widgetId,this.widgetId=o.widgetId,this.styleSheetUrl=n.styleSheetUrl,this.selectors=c,this.placementSelector=l,this.placementPosition=h,this.widgetWrapperStart=f,this.widgetWrapperEnd=d,this.options=r,this.config=n,this.integrations=s,this.gdpr=a,this.dt=u,this.responsesTracked=0,this.widgetIsInIframe=function(){try{return window.self!==window.top}catch(t){return!0}}(),this._widgetContainerSelector="."+this.config.tag+"-widget-container",this._dedicatedContainerSelector=this._widgetContainerSelector,this._adBlockCheckingContainerId=this.config.tag+"-check",this._journalId=o.id,this._switches=o.switches||{},this._eventLogger=i,this.handleIntegrations=function(){return null},this.isDefinedPromise=null}return o(t,[{key:"define",value:function(){var t=this;this.isDefinedPromise=new Promise(function(e,n){i.default.domready(function(){s.default.log("domReady");var r=document.querySelector(t.options.element),o=t.placementSelector?document.querySelector(t.placementSelector.replace(/#(\d)/g,"#\\3$1 ")):null,i=!1;if(o){var a=window.getComputedStyle(o);i="hidden"!==a.getPropertyValue("visibility")&&"none"!==a.getPropertyValue("display")}t.wrapperStart="",t.wrapperEnd="",o&&i?(t.element=o,t.insertPosition=t.placementPosition||null,t.wrapperStart=t.widgetWrapperStart||"",t.wrapperEnd=t.widgetWrapperEnd||""):t.mainWidget&&(t.element=r),t.element?(t.dt.addDt(),t.addStyle(),"function"==typeof t.options.cbRetrieve&&t.options.cbRetrieve(),e("OK")):n(new Error("No element"))})})}},{key:"prepareIntegrations",value:function(t){var e=this,n=t.articleHeader;this.handleIntegrations=function(){e.integrations.init({dataset:e.dataset,articleId:n.id}),s.default.log("recos"),s.default.log("timeToClickStart"),e.checkAdBlock(),e.gdpr.widgetIsLoaded=!0,e._switches.isUS&&Array.prototype.forEach.call(document.querySelectorAll(".trendmd-widget-dns"),function(t){t.style.display="block"}),"function"==typeof e.options.cb&&e.options.cb()}}},{key:"setFirstResponse",value:function(t){var e=t.type,n=t.text,r=t.articleHeader,o=this.wrapResponsedText(n);this.insertPosition&&"replace"!==this.insertPosition?this.element.insertAdjacentHTML(this.insertPosition,o):this.element.innerHTML=o;var i=this.element.querySelector(this._widgetContainerSelector);i.setAttribute("similar-"+e+"-merged",!0),i.setAttribute("style","display: none;"),i.dataset[this.config.tag+"WidgetId"]=this.widgetId,this._dedicatedContainerSelector=this._widgetContainerSelector+'[data-trendmd-widget-id="'+this.widgetId+'"]',this.trackResponse(),this.prepareIntegrations({articleHeader:r})}},{key:"showWidget",value:function(){this.element.querySelector(this._dedicatedContainerSelector).setAttribute("style","")}},{key:"setSecondResponse",value:function(t){var e=t.type,n=t.text;if(n&&n.length){var r=document.createElement("html");r.innerHTML=n;var o=r.querySelectorAll("li.trendmd-widget-list-item").length,i=this.numberOfRecommendations>o;(this.mainWidget&&o>0||!i)&&(this.mergeSecondaryResponse(n,e),this.balanceListing(),this.showWidget())}this.trackResponse(),this.handleIntegrations()}},{key:"mergeSecondaryResponse",value:function(t,e){var n=this.element.querySelector(this._dedicatedContainerSelector),r=n.querySelectorAll("ol.trendmd-widget-list"),o=document.createElement("html");if(n.setAttribute("similar-"+e+"-merged",!0),o.innerHTML=t,Array.prototype.forEach.call(o.querySelectorAll("ol.trendmd-widget-list"),function(t,e){r[e].innerHTML=t.innerHTML}),"sponsored"===e){var i=o.querySelector(this._widgetContainerSelector);Object.keys(i.dataset).forEach(function(t){n.dataset[t]=i.dataset[t]})}}},{key:"balanceListing",value:function(){var t=this.element.querySelector(this._dedicatedContainerSelector).querySelectorAll("ol.trendmd-widget-list"),e=r(t,2),n=e[0],o=e[1];if(n&&o)for(var i=6,s=-(n.children.length+o.children.length)%2;o.children.length-n.children.length!==s;){if(o.children.length-n.children.length>s){var a=o.removeChild(o.children[0]);n.appendChild(a)}if(o.children.length-n.children.length<s){var u=n.removeChild(n.children[n.children.length-1]);o.insertBefore(u,o.children[0])}if(!(i-=1))return}}},{key:"trackResponse",value:function(){this.responsesTracked+=1,2===this.responsesTracked&&this.widgetIsInIframe&&window.parent.postMessage({linksLoaded:document.getElementsByClassName("trendmd-widget-list-item__link").length,sender:"trendmd"},"*")}},{key:"onClick",value:function(t){this.element.querySelector(this._dedicatedContainerSelector).onclick=function(e){"A"===e.target.tagName&&t(e.target)}}},{key:"wrapResponsedText",value:function(t){return this.wrapperStart+t.replace(/Pending(<span.*?),\s/gm,"$1")+this.wrapperEnd}},{key:"addStyle",value:function(){var t=document.querySelector('link[rel="stylesheet"][href="'+this.styleSheetUrl+'"]');if(t)return t;var e=document.createElement("link");return e.rel="stylesheet",e.type="text/css",e.href=this.styleSheetUrl,e.media="all",document.getElementsByTagName("head")[0].appendChild(e)}},{key:"checkAdBlock",value:function(){var t=document.getElementById(this._adBlockCheckingContainerId);if(t){var e=void 0,n=t.querySelector("#ad-holder");if(n)e="none"===window.getComputedStyle(n).display;else e=!0;this._eventLogger.hasAdBlock=e}}},{key:"dataset",get:function(){return this.element.querySelector(this._dedicatedContainerSelector).dataset}},{key:"widgetContainer",get:function(){return this.element.querySelector(this._dedicatedContainerSelector)}}]),t}();n.default=u},{"./TimeLogger":43,domready:3}],49:[function(t,e,n){(function(e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TrendMD=n.config=void 0;var r=i(t("../Initializer")),o=i(t("../../../version"));function i(t){return t&&t.__esModule?t:{default:t}}var s=n.config={tag:"trendmd",apiUrl:{sponsored:"undefined"!=typeof RSEnvEndpoint&&RSEnvEndpoint?RSEnvEndpoint:"https://www.trendmd.com",nonSponsored:"undefined"!=typeof RSEnvEndpoint&&RSEnvEndpoint?RSEnvEndpoint:"https://cc.trendmd.co"},relevancyUrl:"undefined"!=typeof CollectorEnvEndpoint&&CollectorEnvEndpoint?CollectorEnvEndpoint:"https://academia.trendmd.com",styleSheetUrl:"https://trendmd.s3.amazonaws.com/trendmd.min.css",dtConfig:{dmd:{origin:"https://www.medtargetsystem.com",path:"/beacon/portal-lite"},lhk:{api:"https://caramel.press"}},version:o.default},a=n.TrendMD=r.default;e.TrendMD=new a(s)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../version":50,"../Initializer":39}],50:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default="3.0.10"},{}]},{},[49]);